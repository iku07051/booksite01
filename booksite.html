<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>èª­æ›¸ã‚¿ã‚¤ãƒ—è¨ºæ–­ | Book Personality Lab</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #f7f2ea;
      --card-bg: #ffffff;
      --accent: #7fc7b5;
      --accent-soft: #c7efe4;
      --accent-strong: #56a896;
      --text-main: #262626;
      --text-sub: #666666;
      --danger: #f28b82;
      --radius-lg: 24px;
      --radius-full: 999px;
      --shadow-soft: 0 10px 30px rgba(0,0,0,0.06);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, system-ui, "Helvetica Neue", "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #ffeef5 0, #f7f2ea 45%, #e8f6f3 100%);
      color: var(--text-main);
    }

    .app {
      max-width: 820px;
      margin: 0 auto;
      padding: 28px 16px 40px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: stretch;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 16px;
    }
    .logo-mark {
      width: 32px;
      height: 32px;
      border-radius: 14px;
      background: linear-gradient(135deg, var(--accent), #ffd6e5);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 700;
      font-size: 18px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.12);
    }
    .logo-text {
      font-size: 0.9rem;
      font-weight: 600;
      letter-spacing: 0.04em;
      color: var(--text-sub);
    }

    .card {
      background: rgba(255,255,255,0.97);
      border-radius: var(--radius-lg);
      padding: 22px 18px 24px;
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(16px);
      animation: fadeIn 0.35s ease-out;
    }

    h1 {
      font-size: 1.8rem;
      margin: 0 0 6px;
      letter-spacing: 0.04em;
    }

    .subtitle {
      color: var(--text-sub);
      font-size: 0.95rem;
      margin-bottom: 18px;
      line-height: 1.6;
    }

    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 18px;
    }
    .badge {
      font-size: 0.75rem;
      padding: 4px 10px;
      border-radius: 999px;
      background: #f0f0f5;
      color: #555;
    }
    .badge.main {
      background: var(--accent-soft);
      color: #155c4e;
      font-weight: 600;
    }

    .button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 11px 22px;
      border-radius: var(--radius-full);
      border: none;
      background: var(--accent);
      color: #fff;
      font-size: 0.98rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.15s ease, background 0.15s ease;
      box-shadow: 0 10px 24px rgba(64, 145, 124, 0.35);
      white-space: nowrap;
    }
    .button span {
      margin-left: 6px;
      font-size: 1.1rem;
    }
    .button:hover {
      background: var(--accent-strong);
      transform: translateY(-1px) scale(1.01);
      box-shadow: 0 14px 30px rgba(64, 145, 124, 0.4);
    }
    .button:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 6px 16px rgba(64, 145, 124, 0.3);
    }
    .button:disabled {
      background: #c8c8d0;
      box-shadow: none;
      cursor: default;
      transform: none;
    }
    .button.secondary {
      background: #ffffff;
      color: var(--accent-strong);
      border: 1px solid var(--accent-soft);
      box-shadow: 0 6px 16px rgba(0,0,0,0.06);
    }
    .button.secondary:hover {
      background: #f4fffb;
    }

    .question-index {
      font-size: 0.85rem;
      color: var(--text-sub);
      margin-bottom: 6px;
    }
    .question-text {
      font-size: 1.1rem;
      font-weight: 650;
      line-height: 1.6;
      margin-bottom: 18px;
    }

    .progress-shell {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }
    .progress-label {
      font-size: 0.8rem;
      color: var(--text-sub);
    }
    .progress-bar {
      flex: 1;
      height: 8px;
      border-radius: var(--radius-full);
      background: #e4e4ec;
      overflow: hidden;
      position: relative;
    }
    .progress-inner {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), #ffc5dd);
      transition: width 0.25s ease-out;
    }

    .choices {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 18px;
    }
    .choice {
      border-radius: var(--radius-full);
      border: 1px solid #e0e0ea;
      padding: 9px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      transition: background 0.15s ease, border-color 0.15s ease, transform 0.08s ease, box-shadow 0.15s ease;
      background: #fafafa;
    }
    .choice-main {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.95rem;
    }
    .choice-pill {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 2px solid #c2c2d0;
      position: relative;
      flex-shrink: 0;
    }
    .choice-pill::after {
      content: "";
      position: absolute;
      left: 50%;
      top: 50%;
      width: 10px;
      height: 10px;
      transform: translate(-50%, -50%) scale(0);
      border-radius: inherit;
      background: var(--accent);
      transition: transform 0.12s ease-out;
    }
    .choice-hint {
      font-size: 0.75rem;
      color: #999;
    }
    .choice.selected {
      background: #ffffff;
      border-color: var(--accent);
      box-shadow: 0 8px 20px rgba(64, 145, 124, 0.15);
      transform: translateY(-1px);
    }
    .choice.selected .choice-pill {
      border-color: var(--accent-strong);
    }
    .choice.selected .choice-pill::after {
      transform: translate(-50%, -50%) scale(1);
    }

    .nav-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .nav-left {
      font-size: 0.82rem;
      color: var(--text-sub);
    }

    .result-title {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 4px;
    }
    .result-type {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 1.05rem;
      font-weight: 650;
      padding: 6px 12px;
      border-radius: var(--radius-full);
      background: var(--accent-soft);
      color: #155c4e;
      margin-bottom: 10px;
    }
    .result-chip-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: linear-gradient(135deg, #ffb7c5, #b39ddb);
    }
    .result-desc {
      font-size: 0.95rem;
      color: var(--text-sub);
      line-height: 1.7;
      margin-bottom: 18px;
    }

    .book-card {
      border-radius: 18px;
      border: 1px solid #eee;
      padding: 14px 14px 12px;
      background: linear-gradient(135deg, #fff, #fff7f3);
      display: flex;
      gap: 10px;
      align-items: flex-start;
      margin-bottom: 12px;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.15s ease;
    }
    .book-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 24px rgba(0,0,0,0.12);
    }
    .book-thumb {
      width: 48px;
      height: 70px;
      border-radius: 8px;
      background: linear-gradient(135deg, #ffd6e5, #c3f0e2);
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 700;
      color: #555;
      box-shadow: 0 6px 14px rgba(0,0,0,0.18);
      overflow: hidden;
    }
    .book-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .book-body {
      flex: 1;
    }
    .book-title {
      font-weight: 650;
      margin-bottom: 2px;
      font-size: 0.96rem;
    }
    .book-meta {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 4px;
    }
    .book-isbn {
      font-size: 0.8rem;
      color: #999;
    }

    .tags-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }
    .tag-pill {
      font-size: 0.75rem;
      padding: 3px 10px;
      border-radius: 999px;
      background: #f1ebff;
      color: #5c4a92;
    }

    .restart-row {
      margin-top: 16px;
      display: flex;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    .footer-note {
      margin-top: 14px;
      font-size: 0.76rem;
      color: #999;
      text-align: center;
    }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 30;
    }
    .modal-card {
      width: min(480px, 92vw);
      max-height: 80vh;
      background: #ffffff;
      border-radius: 20px;
      padding: 18px 18px 16px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
      gap: 10px;
      animation: fadeIn 0.25s ease-out;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .modal-title {
      font-size: 1rem;
      font-weight: 650;
    }
    .modal-close {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      border: none;
      background: #f2f2f5;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 18px;
    }
    .modal-main {
      display: flex;
      gap: 12px;
    }
    .modal-cover {
      width: 96px;
      height: 140px;
      border-radius: 10px;
      background: linear-gradient(135deg, #ffd6e5, #c3f0e2);
      box-shadow: 0 10px 22px rgba(0,0,0,0.18);
      overflow: hidden;
      flex-shrink: 0;
    }
    .modal-cover img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .modal-meta {
      font-size: 0.86rem;
      color: #555;
    }
    .modal-meta-row {
      margin-bottom: 4px;
    }
    .modal-label {
      font-weight: 600;
      margin-right: 4px;
    }
    .modal-desc {
      margin-top: 6px;
      font-size: 0.85rem;
      color: #666;
      line-height: 1.6;
      max-height: 120px;
      overflow-y: auto;
    }
    .modal-footer {
      display: flex;
      justify-content: flex-end;
      margin-top: 6px;
      gap: 8px;
    }
    .modal-link {
      font-size: 0.8rem;
      color: var(--accent-strong);
      text-decoration: none;
    }

    /* Instagramç”¨éš ã—ã‚­ãƒ£ãƒ³ãƒã‚¹ */
    #shareCanvasSource {
      position: fixed;
      left: -9999px;
      top: 0;
      width: 1080px;
      height: 1350px;
      background: radial-gradient(circle at top, #ffe0eb 0, #f7f2ea 40%, #d8f4ea 100%);
      padding: 64px 80px;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, system-ui, "Helvetica Neue", "Segoe UI", sans-serif;
      color: #222;
    }
    .share-logo-row {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 40px;
    }
    .share-logo-mark {
      width: 54px;
      height: 54px;
      border-radius: 22px;
      background: linear-gradient(135deg, var(--accent), #ffd6e5);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 700;
      font-size: 28px;
      box-shadow: 0 10px 26px rgba(0,0,0,0.15);
    }
    .share-logo-text {
      font-size: 18px;
      font-weight: 650;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #4a5f5a;
    }
    .share-type-title {
      font-size: 40px;
      font-weight: 750;
      margin-bottom: 10px;
      line-height: 1.3;
    }
    .share-type-sub {
      font-size: 18px;
      color: #666;
      margin-bottom: 32px;
    }
    .share-main-row {
      display: flex;
      gap: 32px;
      align-items: flex-start;
    }
    .share-book-block {
      width: 320px;
      border-radius: 26px;
      background: linear-gradient(145deg, #ffffff, #fff4eb);
      padding: 22px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.14);
      box-sizing: border-box;
    }
    .share-book-cover {
      width: 180px;
      height: 260px;
      margin: 0 auto 16px;
      border-radius: 18px;
      background: linear-gradient(135deg, #ffd6e5, #c3f0e2);
      box-shadow: 0 18px 40px rgba(0,0,0,0.25);
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .share-book-cover img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .share-book-title {
      font-size: 18px;
      font-weight: 650;
      margin-bottom: 4px;
      text-align: center;
    }
    .share-book-author {
      font-size: 14px;
      color: #666;
      text-align: center;
      margin-bottom: 10px;
    }
    .share-book-isbn {
      font-size: 12px;
      color: #999;
      text-align: center;
    }
    .share-desc-block {
      flex: 1;
      border-radius: 24px;
      background: rgba(255,255,255,0.9);
      padding: 20px 22px;
      box-shadow: 0 14px 34px rgba(0,0,0,0.1);
      font-size: 15px;
      line-height: 1.8;
      color: #444;
    }
    .share-footer {
      position: absolute;
      bottom: 40px;
      left: 80px;
      right: 80px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      color: #777;
    }
    .share-tagline {
      font-weight: 500;
    }
    .share-url {
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      letter-spacing: 0.03em;
    }

    @media (min-width: 768px) {
      .card {
        padding: 26px 26px 28px;
      }
      h1 {
        font-size: 2rem;
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(6px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="logo">
      <div class="logo-mark">B</div>
      <div class="logo-text">Book Personality Lab</div>
    </div>

    <!-- START SCREEN -->
    <div id="screen-start" class="card">
      <h1>èª­æ›¸ã‚¿ã‚¤ãƒ—è¨ºæ–­</h1>
      <p class="subtitle">
        11ã®è³ªå•ã«ç›´æ„Ÿã§ã“ãŸãˆã‚‹ã ã‘ã§ã€<br />
        ã‚ãªãŸã®ã€Œèª­æ›¸æ°—è³ªã€ã¨ã€ã„ã¾ã®ã‚ãªãŸã«ã„ã¡ã°ã‚“è¿‘ã„ä¸€å†ŠãŒã‚ã‹ã‚Šã¾ã™ã€‚
      </p>

      <div class="badge-row">
        <span class="badge main">æœ¬ã¨ã®ãƒŸã‚¹ãƒãƒƒãƒã‚’ãªãã™ãŸã‚ã®è¨ºæ–­</span>
        <span class="badge">è¨ºæ–­æ™‚é–“ï¼š3åˆ†</span>
        <span class="badge">å…¨11å• / 4æŠ</span>
      </div>

      <button class="button" id="startButton">
        è¨ºæ–­ã‚’ã¯ã˜ã‚ã‚‹ <span>â–¶</span>
      </button>

      <div class="footer-note">
        â€»ã“ã‚Œã¯ä¼ç”»ç”¨ã®ãƒ¢ãƒƒã‚¯ç”»é¢ã§ã™ã€‚æœ¬ç•ªã§ã¯çµæœã‚¿ã‚¤ãƒ—æ•°ãƒ»æ¨å¥¨ä½œå“ã®ç²¾åº¦ãŒã•ã‚‰ã«ä¸ŠãŒã‚Šã¾ã™ã€‚
      </div>
    </div>

    <!-- QUESTION SCREEN -->
    <div id="screen-question" class="card" style="display:none;">
      <div class="progress-shell">
        <span class="progress-label" id="progressLabel">è³ªå• 1 / 11</span>
        <div class="progress-bar">
          <div class="progress-inner" id="progressInner"></div>
        </div>
      </div>

      <div class="question-index" id="questionCounter"></div>
      <div class="question-text" id="questionText"></div>

      <div class="choices" id="choicesContainer"></div>

      <div class="nav-row">
        <div class="nav-left" id="hintText">æ·±ãè€ƒãˆè¾¼ã¾ãšã€æœ€åˆã®ç›´æ„Ÿã§å¤§ä¸ˆå¤«ã€‚</div>
        <button class="button" id="nextButton" disabled>æ¬¡ã¸</button>
      </div>
    </div>

    <!-- RESULT SCREEN -->
    <div id="screen-result" class="card" style="display:none;">
      <div class="result-title">è¨ºæ–­çµæœ</div>
      <div class="result-type">
        <span class="result-chip-dot"></span>
        <span id="resultType"></span>
      </div>
      <div class="result-desc" id="resultDesc"></div>

      <div class="book-card" id="bookCard">
        <div class="book-thumb">
          <img id="recBookCover" alt="è¡¨ç´™ç”»åƒ" style="display:none;" />
          <span id="recBookCoverFallback">æœ¬</span>
        </div>
        <div class="book-body">
          <div class="book-title" id="recBookTitle"></div>
          <div class="book-meta" id="recBookAuthor"></div>
          <div class="book-isbn" id="recBookIsbn"></div>
          <div class="tags-row" id="recTags"></div>
        </div>
      </div>

      <div class="restart-row">
        <button class="button secondary" id="shareImageButton">ğŸ“¸ çµæœã‚’ç”»åƒã§ä¿å­˜</button>
        <button class="button" id="restartButton">ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹</button>
      </div>

      <div class="footer-note">
        â€» æ¨è–¦ã¯ãƒ¢ãƒƒã‚¯ç”¨ã®ç°¡æ˜“ãƒ­ã‚¸ãƒƒã‚¯ã§ã™ã€‚æœ¬ç•ªã§ã¯èª­æ›¸ã‚¿ã‚¤ãƒ— Ã— ã‚¸ãƒ£ãƒ³ãƒ«å¥½ã¿ Ã— åª’ä½“å—œå¥½ã‹ã‚‰ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ã•ã‚Œã¾ã™ã€‚
      </div>
    </div>
  </div>

  <!-- æœ¬ã®è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="bookModal" class="modal-backdrop" style="display:none;">
    <div class="modal-card">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle"></div>
        <button class="modal-close" id="modalCloseButton">Ã—</button>
      </div>
      <div class="modal-main">
        <div class="modal-cover">
          <img id="modalCoverImg" alt="è¡¨ç´™ç”»åƒ" style="display:none;" />
        </div>
        <div class="modal-meta">
          <div class="modal-meta-row">
            <span class="modal-label">è‘—è€…</span><span id="modalAuthor"></span>
          </div>
          <div class="modal-meta-row">
            <span class="modal-label">å‡ºç‰ˆç¤¾</span><span id="modalPublisher"></span>
          </div>
          <div class="modal-meta-row">
            <span class="modal-label">åˆŠè¡Œå¹´</span><span id="modalYear"></span>
          </div>
          <div class="modal-meta-row">
            <span class="modal-label">ISBN</span><span id="modalIsbn"></span>
          </div>
          <div class="modal-desc" id="modalDesc"></div>
        </div>
      </div>
      <div class="modal-footer">
        <a href="#" target="_blank" id="modalAmazonLink" class="modal-link" rel="noopener noreferrer">
          Amazonã§è¦‹ã‚‹ â†—
        </a>
      </div>
    </div>
  </div>

  <!-- Instagramç”¨éš ã—ã‚­ãƒ£ãƒ³ãƒã‚¹ -->
  <div id="shareCanvasSource">
    <div class="share-logo-row">
      <div class="share-logo-mark">B</div>
      <div class="share-logo-text">BOOK PERSONALITY LAB</div>
    </div>
    <div class="share-type-title" id="shareTypeTitle">ãƒ”ãƒ³ã‚¯ãƒ–ãƒ­ãƒƒã‚µãƒ ãƒ»ãƒŸãƒƒã‚¯ã‚¹ãƒ¯ãƒ¼ãƒ«ãƒ‰ã‚¿ã‚¤ãƒ—</div>
    <div class="share-type-sub">ã‚ãªãŸã®èª­æ›¸ã‚¿ã‚¤ãƒ—ã¨ã€ã„ã¾ã®ã‚ãªãŸã«ã„ã¡ã°ã‚“è¿‘ã„ä¸€å†Šã€‚</div>
    <div class="share-main-row">
      <div class="share-book-block">
        <div class="share-book-cover">
          <img id="shareBookCover" alt="book cover" style="display:none;" />
        </div>
        <div class="share-book-title" id="shareBookTitle">ãŠã™ã™ã‚ã®ä¸€å†Šã‚¿ã‚¤ãƒˆãƒ«</div>
        <div class="share-book-author" id="shareBookAuthor">è‘—è€…å</div>
        <div class="share-book-isbn" id="shareBookIsbn">ISBN:</div>
      </div>
      <div class="share-desc-block" id="shareDescText">
        æœ¬ç•ªã§ã¯ã“ã“ã«èª­æ›¸ã‚¿ã‚¤ãƒ—ã®è¦ç´„ãŒå…¥ã‚Šã€ã‚ãªãŸã®ã€Œèª­ã¿æ–¹ã®ã‚¯ã‚»ã€ã‚„ã€Œåˆºã•ã‚Šã‚„ã™ã„ç‰©èªã®å‚¾å‘ã€ãŒã²ã¨ç›®ã§ã‚ã‹ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
      </div>
    </div>
    <div class="share-footer">
      <div class="share-tagline">èª­æ›¸ã¨ã®ãƒŸã‚¹ãƒãƒƒãƒã‚’ãªãã™ãŸã‚ã®è¨ºæ–­ã€‚</div>
      <div class="share-url">book-personality.example.com</div>
    </div>
  </div>

  <!-- html2canvasï¼ˆçµæœç”»åƒç”Ÿæˆç”¨ï¼‰ -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <script>
    // =========================
    // è³ªå•ï¼ˆæ–­å®šèª¿ãƒ»11å•ï¼‰
    // =========================
    const questions = [
      "ç‰©èªã‚ˆã‚Šã‚‚ã€çŸ¥è­˜ã‚„æƒ…å ±ãŒæ‰‹ã«å…¥ã‚‹ä½œå“ã‚’é¸ã³ãŒã¡ã ã€‚",
      "ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®æ„Ÿæƒ…ã«å¼·ãå…±é³´ã—ãªãŒã‚‰èª­ã‚€ã»ã†ã ã€‚",
      "ãƒ†ãƒ³ãƒã‚ˆãä¸€æ°—ã«èª­ã¿é€²ã‚ã‚‰ã‚Œã‚‹ä½œå“ã‚’æœ€å„ªå…ˆã™ã‚‹ã»ã†ã ã€‚",
      "èª­ã¿çµ‚ã‚ã‚‹ã¾ã§æ™‚é–“ãŒã‹ã‹ã£ã¦ã‚‚ã€é‡åšãªç‰©èªã®ã»ã†ã«æº€è¶³ã‚’æ„Ÿã˜ã‚‹ã»ã†ã ã€‚",
      "ç¾å®Ÿã®å»¶é•·ç·šä¸Šã«ã‚ã‚‹ã€ãƒªã‚¢ãƒ«ãªé¡Œæã®ç‰©èªãŒåˆºã•ã‚Šã‚„ã™ã„ã»ã†ã ã€‚",
      "ç¾å®Ÿé›¢ã‚Œã—ãŸè¨­å®šã‚„ä¸–ç•Œè¦³ã«ã©ã£ã·ã‚Šæµ¸ã‹ã‚Œã‚‹ç‰©èªã«æƒ¹ã‹ã‚Œã‚‹ã»ã†ã ã€‚",
      "ã€ŒãŠã‚‚ã—ã‚ã„ã€ã‚ˆã‚Šã‚‚ã€Œãªã«ã‹ã‚’è€ƒãˆã•ã›ã¦ãã‚Œã‚‹ä½œå“ã€ã‚’æ±‚ã‚ã‚‹ã»ã†ã ã€‚",
      "çŸ­æ™‚é–“ã§èª­ã¿åˆ‡ã‚Œã‚‹ä½œå“ã‚ˆã‚Šã€æ™‚é–“ã‚’ã‹ã‘ã¦æµ¸ã‚‹ä½œå“ãŒå‘ã„ã¦ã„ã‚‹ã»ã†ã ã€‚",
      "ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®å¿ƒã®å‹•ããŒã¦ã„ã­ã„ã«æã‹ã‚ŒãŸä½œå“ã«ä¾¡å€¤ã‚’æ„Ÿã˜ã‚‹ã»ã†ã ã€‚",
      "ä¼ç·šå›åã‚„æ§‹é€ ã®ç·»å¯†ã•ãŒã€ä½œå“é¸ã³ã®æ±ºã‚æ‰‹ã«ãªã‚Šã‚„ã™ã„ã»ã†ã ã€‚",
      "èª­ã¿çµ‚ã‚ã£ãŸã‚ã¨ã€èª°ã‹ã¨æ„Ÿæƒ³ã‚’å…±æœ‰ã—ãŸããªã‚‹ã“ã¨ãŒå¤šã„ã»ã†ã ã€‚"
    ];

    const choices = [
      { label: "ã¯ã„", value: 2, hint: "ã‹ãªã‚Šå½“ã¦ã¯ã¾ã‚‹" },
      { label: "ã©ã¡ã‚‰ã‹ã¨ã„ãˆã°ã¯ã„", value: 1, hint: "ãªã‚“ã¨ãªãå½“ã¦ã¯ã¾ã‚‹" },
      { label: "ã©ã¡ã‚‰ã‹ã¨ã„ãˆã°ã„ã„ãˆ", value: -1, hint: "ã‚ã¾ã‚Šå½“ã¦ã¯ã¾ã‚‰ãªã„" },
      { label: "ã„ã„ãˆ", value: -2, hint: "ã¾ã£ãŸãå½“ã¦ã¯ã¾ã‚‰ãªã„" }
    ];

    // ä½œå“ãƒ‡ãƒ¼ã‚¿ï¼ˆ80å†Šï¼‰
    const books = [
      { id:1,  title:"medium éœŠåª’æ¢åµåŸå¡šç¿¡ç¿ ", author:"ç›¸æ²¢æ²™å‘¼", isbn:"978-4065170946" },
      { id:2,  title:"invert åŸå¡šç¿¡ç¿ å€’å™é›†", author:"ç›¸æ²¢æ²™å‘¼", isbn:"978-4065237328" },
      { id:3,  title:"invert â…¡ è¦—ãçª“ã®æ­»è§’", author:"ç›¸æ²¢æ²™å‘¼", isbn:"978-4065286388" },
      { id:4,  title:"å°èª¬ã®ç¥æ§˜", author:"ç›¸æ²¢æ²™å‘¼", isbn:"978-4062940344" },
      { id:5,  title:"ã“ã®é…ä¿¡ã¯çµ‚äº†ã—ã¾ã—ãŸ", author:"é’æœ¨é›ªå¹³", isbn:"978-4575248197" },
      { id:6,  title:"æš—é»’å°‘å¥³", author:"ç§‹å‰ç†é¦™å­", isbn:"978-4575238259" },
      { id:7,  title:"è‡ªæ®ºäºˆå®šæ—¥", author:"ç§‹å‰ç†é¦™å­", isbn:"978-4488418212" },
      { id:8,  title:"æ­£æ¬²", author:"æœäº•ãƒªãƒ§ã‚¦", isbn:"978-4-10-126933-7" },
      { id:9,  title:"ä½•è€…", author:"æœäº•ãƒªãƒ§ã‚¦", isbn:"978-4-10-126931-3" },
      { id:10, title:"æ¡å³¶ã€éƒ¨æ´»ã‚„ã‚ã‚‹ã£ã¦ã‚ˆ", author:"æœäº•ãƒªãƒ§ã‚¦", isbn:"978-4-08-771335-0" },
      { id:11, title:"ç”Ÿæ®–è¨˜", author:"æœäº•ãƒªãƒ§ã‚¦", isbn:"978-4-09-386730-6" },
      { id:12, title:"ä¸–ã«ã‚‚å¥‡å¦™ãªå›ç‰©èª", author:"æœäº•ãƒªãƒ§ã‚¦", isbn:"978-4-06-219824-0" },
      { id:13, title:"æ­¦é“é¤¨", author:"æœäº•ãƒªãƒ§ã‚¦", isbn:"978-4-06-219824-0" },
      { id:14, title:"ã©ã†ã—ã¦ã‚‚ç”Ÿãã¦ã‚‹", author:"æœäº•ãƒªãƒ§ã‚¦", isbn:"978-4-34-403516-4" },
      { id:15, title:"ä¿ºã§ã¯ãªã„ç‚ä¸Š", author:"æµ…å€‰ç§‹æˆ", isbn:"978-4-57-552758-2" },
      { id:16, title:"6äººã®å˜˜ã¤ããªå¤§å­¦ç”Ÿ", author:"æµ…å€‰ç§‹æˆ", isbn:"978-4041098790" },
      { id:17, title:"å®¶æ—è§£æ•£ã¾ã§åƒã‚­ãƒ­ãƒ¡ãƒ¼ãƒˆãƒ«", author:"æµ…å€‰ç§‹æˆ", isbn:"978-4041145647" },
      { id:18, title:"å˜˜ã¨éš£äºº", author:"èŠ¦æ²¢å¤®", isbn:"978-4163919713" },
      { id:19, title:"è¨±ã•ã‚Œã‚ˆã†ã¨ã¯æ€ã„ã¾ã›ã‚“", author:"èŠ¦æ²¢å¤®", isbn:"978-4101014319" },
      { id:20, title:"æ®ºæˆ®ã«ã„ãŸã‚‹ç—…", author:"æˆ‘å­«å­æ­¦ä¸¸", isbn:"978-4041145647" },
      { id:21, title:"ä¿®ç¾…ã®å®¶", author:"æˆ‘å­«å­æ­¦ä¸¸", isbn:"978-4-065-32461-5" },
      { id:22, title:"ï¼ã®æ®ºäºº", author:"æˆ‘å­«å­æ­¦ä¸¸", isbn:"978-4-061-85227-3" },
      { id:23, title:"ç®±ç”·", author:"å®‰å€å·¥æˆ¿", isbn:"978-4-101-12116-1" },
      { id:24, title:"åè§’é¤¨ã®æ®ºäºº", author:"ç¶¾è¾»è¡Œäºº", isbn:"978-4-06-275857-4" },
      { id:25, title:"ãã¾ã™ã‘ã¨ä¸€ç·’ã«", author:"æ–°äº•ç´ å­", isbn:"978-4-12-207599-3" },
      { id:26, title:"ã‚ˆã†ã“ãã€æˆ‘ãŒå®¶ã¸", author:"æ± äº•æˆ¸æ½¤", isbn:"978-4-09-408843-4" },
      { id:27, title:"ä¿ºãŸã¡ãƒãƒ–ãƒ«å…¥è¡Œçµ„", author:"æ± äº•æˆ¸æ½¤", isbn:"978-4-16-323600-1" },
      { id:28, title:"ä¸‹ç”ºãƒ­ã‚±ãƒƒãƒˆ", author:"æ± äº•æˆ¸æ½¤", isbn:"978-4-09-408896-0" },
      { id:29, title:"ã‚·ãƒ£ã‚¤ãƒ­ãƒƒã‚¯ã®å­ä¾›ãŸã¡", author:"æ± äº•æˆ¸æ½¤", isbn:"978-4-16-324630-7" },
      { id:30, title:"æ°‘ç‹", author:"æ± äº•æˆ¸æ½¤", isbn:"978-4-59-111662-3" },
      { id:31, title:"ãƒãƒ¤ãƒ–ã‚µæ¶ˆé˜²å›£", author:"æ± äº•æˆ¸æ½¤", isbn:"978-4-08-744767-5" },
      { id:32, title:"ã‚¢ã‚­ãƒ©ã¨ã‚ãã‚‰", author:"æ± äº•æˆ¸æ½¤", isbn:"978-4-19-894230-4" },
      { id:33, title:"ä¸ƒã¤ã®ä¼šè­°", author:"æ± äº•æˆ¸æ½¤", isbn:"978-4-08-745412-3" },
      { id:34, title:"ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ»ã‚²ãƒ¼ãƒ ", author:"æ± äº•æˆ¸æ½¤", isbn:"978-4-06-529910-4" },
      { id:35, title:"ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¹ãƒ©ãƒ³ãƒãƒ¼", author:"ä¼Šå‚å¹¸å¤ªéƒ", isbn:"978-4-10-125026-7" },
      { id:36, title:"ã‚°ãƒ©ã‚¹ãƒ›ãƒƒãƒ‘ãƒ¼", author:"ä¼Šå‚å¹¸å¤ªéƒ", isbn:"978-4-16-324630-7" },
      { id:37, title:"é­”ç‹", author:"ä¼Šå‚å¹¸å¤ªéƒ", isbn:"978-4-06-213146-9" },
      { id:38, title:"å¨¼å¹´", author:"çŸ³ç”°è¡£è‰¯", isbn:"978-4-08-747694-1" },
      { id:39, title:"æ± è¢‹ã‚¦ã‚¨ã‚¹ãƒˆã‚²ãƒ¼ãƒˆãƒ‘ãƒ¼ã‚¯", author:"çŸ³ç”°è¡£è‰¯", isbn:"978-4-16-717403-3" },
      { id:40, title:"ã„ã¾ã€ä¼šã„ã«ã‚†ãã¾ã™", author:"å¸‚å·æ‹“å¸", isbn:"978-4-09-408217-3" },
      { id:41, title:"å¤«æ‹æ®ºã€€ã¤ã¾ã”ã„ã”ã‚ã—", author:"é­šå´ä¾çŸ¥å­", isbn:"978-4041147474" },
      { id:42, title:"æ™‚è¨ˆã¯äºŒåº¦ã¨å‡ã‚‰ãªã„", author:"é­šå´ä¾çŸ¥å­", isbn:"978-4863114609" },
      { id:43, title:"å¤‰ãªå®¶", author:"é›¨ç©´", isbn:"978-4864108454" },
      { id:44, title:"å¤‰ãªçµµ", author:"é›¨ç©´", isbn:"978-4575528138" },
      { id:45, title:"å¤‰ãªå®¶2", author:"é›¨ç©´", isbn:"978-4864109826" },
      { id:46, title:"å¤‰ãªåœ°å›³", author:"é›¨ç©´", isbn:"978-4575248104" },
      { id:47, title:"æ¡œã®ã‚ˆã†ãªåƒ•ã®æ‹äºº", author:"å®‡å±±ä½³ç¥", isbn:"978-4087455489" },
      { id:48, title:"ã“ã®æ‹ã¯ä¸–ç•Œã§ã„ã¡ã°ã‚“ç¾ã—ã„é›¨", author:"å®‡å±±ä½³ç¥", isbn:"978-4087442571" },
      { id:49, title:"æ‹ã«ç„¦ãŒã‚ŒãŸãƒ–ãƒ«ãƒ¼ï¼¾", author:"å®‡å±±ä½³ç¥", isbn:"978-4087445220" },
      { id:50, title:"ã²ã¾ã‚ã‚Šã¯æ‹ã®å½¢", author:"å®‡å±±ä½³ç¥", isbn:"978-4093866392" },
      { id:51, title:"ãªãœã©ã†ã®å‰£ã¾ã§ã—ã‹å£²ã‚‰ãªã„ã‚“ã§ã™ã‹ï¼Ÿ", author:"ã‚¨ãƒ•", isbn:"978-4408537740" },
      { id:52, title:"æ¨ã—ã®æ®ºäºº", author:"é è—¤ã‹ãŸã‚‹", isbn:"978-4299051134" },
      { id:53, title:"ï¼ƒãƒãƒ³ãƒ›ãƒ¼ãƒ«", author:"å²¡ç”°é“å°š", isbn:"978-4299039170" },
      { id:54, title:"ç·‘ã®æˆ‘ãŒå®¶", author:"å°é‡ä¸ç”±ç¾", isbn:"978-4041127506" },
      { id:55, title:"ãƒãƒ¼ãƒ ãƒ»ãƒãƒã‚¹ã‚¿ã®æ „å…‰", author:"æµ·å ‚å°Š", isbn:"978-4796650793" },
      { id:56, title:"ãƒ–ãƒ©ãƒƒã‚¯ãƒšã‚¢ãƒ³1988", author:"æµ·å ‚å°Š", isbn:"978-4062142540" },
      { id:57, title:"å…«æ—¥ç›®ã®è‰", author:"è§’ç”°å…‰ä»£", isbn:"978-4122054257" },
      { id:58, title:"å¯¾å²¸ã®å½¼å¥³", author:"è§’ç”°å…‰ä»£", isbn:"978-4167672058" },
      { id:59, title:"ã‚ªãƒ«ã‚¿ãƒãƒ¼ãƒˆ", author:"åŠ è—¤ã‚·ã‚²ã‚¢ã‚­", isbn:"978-4103537311" },
      { id:60, title:"ãƒ”ãƒ³ã‚¯ã¨ã‚°ãƒ¬ãƒ¼", author:"åŠ è—¤ã‚·ã‚²ã‚¢ã‚­", isbn:"978-4087447309" },
      { id:61, title:"ãªã‚Œã®ã¯ã¦", author:"åŠ è—¤ã‚·ã‚²ã‚¢ã‚­", isbn:"978-4065331439" },
      { id:62, title:"è›‡ã«ãƒ”ã‚¢ã‚¹", author:"é‡‘åŸã²ã¨ã¿", isbn:"978-4087460483" },
      { id:63, title:"ãƒŸãƒ¼ãƒ„ãƒ»ã‚¶ãƒ»ãƒ¯ãƒ¼ãƒ«ãƒ‰", author:"é‡‘åŸã²ã¨ã¿", isbn:"978-4087447309" },
      { id:64, title:"é»„è‰²ã„å®¶", author:"å·ä¸Š æœªæ˜ å­", isbn:"978-4120056284" },
      { id:65, title:"å˜˜ã¤ããªç§ã¨ã€ç´«ã®ç³", author:"ç¥æˆ¸é¥çœŸ", isbn:"978-4867165348" },
      { id:66, title:"å…¨èƒ½ã®ã‚«ãƒŸãƒŠ", author:"å–œå¤šå–œä¹…", isbn:"978-4302100071" },
      { id:67, title:"ï¼‘ãƒªãƒƒãƒˆãƒ«ã®æ¶™", author:"æœ¨è—¤äºœä¹Ÿ", isbn:"978-4-344-40610-0" },
      { id:68, title:"äºŒäººä¸€çµ„ã«ãªã£ã¦ãã ã•ã„", author:"æœ¨çˆ¾ãƒãƒ¬ãƒ³", isbn:"978-4575247688" },
      { id:69, title:"ç¥ã«æ„›ã•ã‚Œã¦ã„ãŸ", author:"æœ¨çˆ¾ãƒãƒ¬ãƒ³", isbn:"978-4408538402" },
      { id:70, title:"ã¿ã‚“ãªè›ã‚’æ®ºã—ãŸã‹ã£ãŸ", author:"æœ¨çˆ¾ãƒãƒ¬ãƒ³", isbn:"978-4576211015" },
      { id:71, title:"æ­»åˆ‘ã«ã„ãŸã‚‹ç—…", author:"æ«›æœ¨ç†å®‡", isbn:"978-4150313005" },
      { id:72, title:"æ®ºäººä¾å­˜ç—‡", author:"æ«›æœ¨ç†å®‡", isbn:"978-4344430259" },
      { id:73, title:"å¾©è®ã®æ³¥æ²¼", author:"ãã‚ãŒãã‚ã‚†", isbn:"978-4299057587" },
      { id:74, title:"ãƒ¬ãƒ¢ãƒ³ã¨æ®ºäººé¬¼", author:"ãã‚ãŒãã‚ã‚†", isbn:"978-4299041678" },
      { id:75, title:"çˆ†å¼¾", author:"å‘‰ å‹æµ©", isbn:"978-4065273470" },
      { id:76, title:"ã‚¹ãƒ¯ãƒ³", author:"å‘‰ å‹æµ©", isbn:"978-4041127575" },
      { id:77, title:"è¨˜æ†¶å–ªå¤±ã®å›ã¨ã€å›ã ã‘ã‚’å¿˜ã‚Œã¦ã—ã¾ã£ãŸåƒ•ã€‚", author:"å°é³¥å±…ã»ãŸã‚‹", isbn:"978-4813704867" },
      { id:78, title:"ã‚¢ãƒªã‚¹æ®ºã—", author:"å°æ—æ³°ä¸‰", isbn:"978-4488420147" },
      { id:79, title:"ä»£è¡¨å–ç· å½¹ã‚¢ã‚¤ãƒ‰ãƒ«", author:"å°æ—æ³°ä¸‰", isbn:"978-4163912134" },
      { id:80, title:"M æ„›ã™ã¹ãäººãŒã„ã¦", author:"å°æ¾æˆç¾", isbn:"978-4344429819" }
    ];

    // çŠ¶æ…‹ç®¡ç†
    let currentIndex = 0;
    let answers = [];
    let currentBook = null;
    let currentBookDetail = null; // Google Booksã‹ã‚‰å–å¾—ã—ãŸè©³ç´°
    let currentTypeInfo = null;

    // DOMè¦ç´ 
    const screenStart = document.getElementById("screen-start");
    const screenQuestion = document.getElementById("screen-question");
    const screenResult = document.getElementById("screen-result");

    const startButton = document.getElementById("startButton");
    const nextButton = document.getElementById("nextButton");
    const restartButton = document.getElementById("restartButton");

    const questionCounter = document.getElementById("questionCounter");
    const questionText = document.getElementById("questionText");
    const choicesContainer = document.getElementById("choicesContainer");
    const progressInner = document.getElementById("progressInner");
    const progressLabel = document.getElementById("progressLabel");

    const resultType = document.getElementById("resultType");
    const resultDesc = document.getElementById("resultDesc");
    const recBookTitle = document.getElementById("recBookTitle");
    const recBookAuthor = document.getElementById("recBookAuthor");
    const recBookIsbn = document.getElementById("recBookIsbn");
    const recTags = document.getElementById("recTags");
    const bookCard = document.getElementById("bookCard");
    const recBookCoverImg = document.getElementById("recBookCover");
    const recBookCoverFallback = document.getElementById("recBookCoverFallback");

    // ãƒ¢ãƒ¼ãƒ€ãƒ«
    const bookModal = document.getElementById("bookModal");
    const modalTitle = document.getElementById("modalTitle");
    const modalAuthor = document.getElementById("modalAuthor");
    const modalPublisher = document.getElementById("modalPublisher");
    const modalYear = document.getElementById("modalYear");
    const modalIsbn = document.getElementById("modalIsbn");
    const modalDesc = document.getElementById("modalDesc");
    const modalCoverImg = document.getElementById("modalCoverImg");
    const modalCloseButton = document.getElementById("modalCloseButton");
    const modalAmazonLink = document.getElementById("modalAmazonLink");

    // Instagramç”¨
    const shareImageButton = document.getElementById("shareImageButton");
    const shareCanvasSource = document.getElementById("shareCanvasSource");
    const shareTypeTitle = document.getElementById("shareTypeTitle");
    const shareBookCoverImg = document.getElementById("shareBookCover");
    const shareBookTitle = document.getElementById("shareBookTitle");
    const shareBookAuthor = document.getElementById("shareBookAuthor");
    const shareBookIsbn = document.getElementById("shareBookIsbn");
    const shareDescText = document.getElementById("shareDescText");

    // ã‚¤ãƒ™ãƒ³ãƒˆ
    startButton.addEventListener("click", () => {
      screenStart.style.display = "none";
      screenQuestion.style.display = "block";
      currentIndex = 0;
      answers = [];
      currentBook = null;
      currentBookDetail = null;
      currentTypeInfo = null;
      renderQuestion();
    });

    nextButton.addEventListener("click", () => {
      const selected = document.querySelector(".choice.selected");
      if (!selected) return;
      const value = Number(selected.dataset.value);
      answers[currentIndex] = value;

      if (currentIndex < questions.length - 1) {
        currentIndex++;
        renderQuestion();
      } else {
        showResult();
      }
    });

    restartButton.addEventListener("click", () => {
      screenResult.style.display = "none";
      screenStart.style.display = "block";
      progressInner.style.width = "0%";
    });

    // æœ¬ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ â†’ ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
    bookCard.addEventListener("click", () => {
      if (!currentBook) return;
      openBookModal();
    });

    modalCloseButton.addEventListener("click", () => {
      bookModal.style.display = "none";
    });

    bookModal.addEventListener("click", (e) => {
      if (e.target === bookModal) {
        bookModal.style.display = "none";
      }
    });

    // ç”»åƒä¿å­˜ãƒœã‚¿ãƒ³
    shareImageButton.addEventListener("click", async () => {
      if (!currentBook || !currentTypeInfo) return;

      // ã‚­ãƒ£ãƒ³ãƒã‚¹ç”¨ã®ãƒ†ã‚­ã‚¹ãƒˆåæ˜ 
      shareTypeTitle.textContent = currentTypeInfo.typeName;
      shareBookTitle.textContent = currentBook.title;
      shareBookAuthor.textContent = `è‘—è€…ï¼š${currentBook.author}`;
      shareBookIsbn.textContent = `ISBNï¼š${currentBook.isbn}`;

      // èª¬æ˜æ–‡ã‚’å°‘ã—çŸ­ãã—ã¦å…¥ã‚Œã‚‹ï¼ˆ100æ–‡å­—ãã‚‰ã„ï¼‰
      const fullDesc = currentTypeInfo.desc || "";
      let shortDesc = fullDesc;
      if (shortDesc.length > 110) {
        shortDesc = shortDesc.slice(0, 108) + "â€¦";
      }
      shareDescText.textContent = shortDesc || "ã‚ãªãŸã®èª­æ›¸ã‚¿ã‚¤ãƒ—ã®è¦ç´„ãŒã“ã“ã«å…¥ã‚Šã¾ã™ã€‚";

      // è¡¨ç´™ç”»åƒï¼ˆã™ã§ã«å–å¾—æ¸ˆã¿ãªã‚‰ãã‚Œã‚’ä½¿ã†ï¼‰
      if (recBookCoverImg && recBookCoverImg.src && recBookCoverImg.style.display !== "none") {
        shareBookCoverImg.src = recBookCoverImg.src;
        shareBookCoverImg.style.display = "block";
      } else {
        shareBookCoverImg.style.display = "none";
      }

      // html2canvasã§ç”»åƒç”Ÿæˆ
      try {
        const canvas = await html2canvas(shareCanvasSource, {
          scale: 2,
          backgroundColor: null,
          useCORS: true
        });
        const dataURL = canvas.toDataURL("image/png");
        const link = document.createElement("a");
        link.href = dataURL;
        link.download = "reading-type-result.png";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      } catch (err) {
        alert("ç”»åƒã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
        console.error(err);
      }
    });

    // è³ªå•æç”»
    function renderQuestion() {
      nextButton.disabled = true;

      questionCounter.textContent = `Q${currentIndex + 1}`;
      questionText.textContent = questions[currentIndex];

      const progress = (currentIndex / questions.length) * 100;
      progressInner.style.width = `${progress}%`;
      progressLabel.textContent = `è³ªå• ${currentIndex + 1} / ${questions.length}`;

      choicesContainer.innerHTML = "";

      choices.forEach((c) => {
        const div = document.createElement("div");
        div.className = "choice";
        div.dataset.value = c.value;

        div.innerHTML = `
          <div class="choice-main">
            <div class="choice-pill"></div>
            <span>${c.label}</span>
          </div>
          <div class="choice-hint">${c.hint}</div>
        `;

        div.addEventListener("click", () => {
          document.querySelectorAll(".choice").forEach(ch => ch.classList.remove("selected"));
          div.classList.add("selected");
          nextButton.disabled = false;
        });

        choicesContainer.appendChild(div);
      });

      if (typeof answers[currentIndex] === "number") {
        const idx = choices.findIndex(c => c.value === answers[currentIndex]);
        if (idx >= 0 && choicesContainer.children[idx]) {
          choicesContainer.children[idx].classList.add("selected");
          nextButton.disabled = false;
        }
      }
    }

    // ã‚¿ã‚¤ãƒ—åˆ¤å®š
    function getTypeInfo(ans) {
      const total = ans.reduce((a, b) => a + b, 0);

      const emotionScore = (ans[1] || 0) + (ans[8] || 0);
      const worldScore = (ans[5] || 0) - (ans[4] || 0);
      const tempoScore = (ans[2] || 0) - (ans[3] || 0);

      let colorWord = "";
      if (emotionScore >= 4) {
        colorWord = "ãƒ”ãƒ³ã‚¯ãƒ–ãƒ­ãƒƒã‚µãƒ ";
      } else if (emotionScore >= 1) {
        colorWord = "ãƒ©ãƒ™ãƒ³ãƒ€ãƒ¼";
      } else if (emotionScore <= -3) {
        colorWord = "ãƒ¢ã‚«ãƒ–ãƒ©ã‚¦ãƒ³";
      } else {
        colorWord = "ãƒŸãƒ³ãƒˆã‚°ãƒªãƒ¼ãƒ³";
      }

      let worldWord = "";
      if (worldScore >= 3) {
        worldWord = "ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼ãƒ¯ãƒ¼ãƒ«ãƒ‰";
      } else if (worldScore >= 1) {
        worldWord = "ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ¯ãƒ¼ãƒ«ãƒ‰";
      } else if (worldScore <= -3) {
        worldWord = "ãƒªã‚¢ãƒ«ãƒ©ã‚¤ãƒ•";
      } else if (worldScore <= -1) {
        worldWord = "æ—¥å¸¸ãƒ‰ãƒ©ãƒ";
      } else {
        worldWord = "ãƒŸãƒƒã‚¯ã‚¹ãƒ¯ãƒ¼ãƒ«ãƒ‰";
      }

      const typeName = `${colorWord}ãƒ»${worldWord}ã‚¿ã‚¤ãƒ—`;

      let desc = "";

      if (colorWord === "ãƒ”ãƒ³ã‚¯ãƒ–ãƒ­ãƒƒã‚µãƒ " && worldWord.includes("ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼")) {
        desc = "æ„Ÿæƒ…ç§»å…¥ã¨éæ—¥å¸¸ã®ä¸–ç•Œè¦³ã®ã©ã¡ã‚‰ã‚‚å¼·ãæ±‚ã‚ã‚‹ã‚¿ã‚¤ãƒ—ã€‚ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®å¿ƒæƒ…ã«å¯„ã‚Šæ·»ã„ãªãŒã‚‰ã€æ—¥å¸¸ã§ã¯å‘³ã‚ãˆãªã„å‡ºæ¥äº‹ã«å·»ãè¾¼ã¾ã‚Œã¦ã„ãç‰©èªã¨ã®ç›¸æ€§ãŒè‰¯ã„ã€‚åˆ‡ãªã•ã‚„ã¨ãã‚ãã®ã‚ã‚‹ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚„ã€ãƒ‰ãƒ©ãƒãƒãƒƒã‚¯ãªå±•é–‹ãŒç¶šãä½œå“ãŒã€Œåˆºã•ã‚‹ä¸€å†Šã€ã«ãªã‚Šã‚„ã™ã„ã€‚";
      } else if (colorWord === "ãƒ”ãƒ³ã‚¯ãƒ–ãƒ­ãƒƒã‚µãƒ ") {
        desc = "äººç‰©ã®æ„Ÿæƒ…ã‚„é–¢ä¿‚æ€§ã‚’ä½•ã‚ˆã‚Šå¤§äº‹ã«ã—ãŸã„ã‚¿ã‚¤ãƒ—ã€‚ä¸–ç•Œè¦³ãŒç¾å®Ÿå¯„ã‚Šã§ã‚‚éæ—¥å¸¸å¯„ã‚Šã§ã‚‚ã€ç™»å ´äººç‰©ã®å¿ƒã®æºã‚Œã‚„è·é›¢æ„ŸãŒä¸å¯§ã«æã‹ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ãŒã€ä½œå“ã®å¥½ãå«Œã„ã‚’åˆ†ã‘ã‚‹ã€‚æ‹æ„›ãƒ»é’æ˜¥ãƒ»ãƒ’ãƒ¥ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒç³»ã®ç‰©èªã«ã¯ã€ç‰¹ã«å¼·ãæƒ¹ãã¤ã‘ã‚‰ã‚Œã‚„ã™ã„ã€‚";
      } else if (colorWord === "ãƒ©ãƒ™ãƒ³ãƒ€ãƒ¼" && worldWord.includes("ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼")) {
        desc = "ä¸–ç•Œè¦³ã®åºƒãŒã‚Šã¨ã€ã—ã£ã¨ã‚Šã—ãŸæ„Ÿæƒ…ã®ä½™éŸ»ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å¥½ã‚€ã‚¿ã‚¤ãƒ—ã€‚æ¿€ã—ã™ãã‚‹å±•é–‹ã‚ˆã‚Šã‚‚ã€é™ã‹ã«å¿ƒã«æ®‹ã‚‹å°è©ã‚„ã‚·ãƒ¼ãƒ³ã‚’ã˜ã£ãã‚Šå‘³ã‚ã„ãŸã„ã»ã†ã€‚å°‘ã—ä¸æ€è­°ãªè¨­å®šã‚„ã€ç¾å®Ÿã¨éš£ã‚Šåˆã‚ã›ã®ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼ä½œå“ã‚’ã€ŒãŠæ°—ã«å…¥ã‚Šã€ã«ã—ã‚„ã™ã„ã€‚";
      } else if (colorWord === "ãƒŸãƒ³ãƒˆã‚°ãƒªãƒ¼ãƒ³" && worldWord.includes("ãƒªã‚¢ãƒ«")) {
        desc = "ã™ã“ã—å¼•ã„ãŸç›®ç·šã§ã€ç¾å®Ÿã«è¿‘ã„ãƒ†ãƒ¼ãƒã‚’å‘³ã‚ã†ã®ãŒå¾—æ„ãªã‚¿ã‚¤ãƒ—ã€‚äººé–“ã‚„ç¤¾ä¼šã‚’æãä½œå“ã®ä¸­ã‹ã‚‰ã€è‡ªåˆ†ãªã‚Šã®è§£é‡ˆã‚„æ°—ã¥ãã‚’æ‹¾ã„ä¸Šã’ã‚‹èª­ã¿æ–¹ãŒå‘ã„ã¦ã„ã‚‹ã€‚ä»•äº‹ãƒ»å®¶æ—ãƒ»å‹æƒ…ãªã©ã€èº«è¿‘ãªé¡Œæã‚’æ‰±ã†ç‰©èªã«ã€ã˜ã‚ã˜ã‚å…±æ„Ÿã™ã‚‹ã“ã¨ãŒå¤šã„ã€‚";
      } else if (colorWord === "ãƒ¢ã‚«ãƒ–ãƒ©ã‚¦ãƒ³") {
        desc = "æ´¾æ‰‹ãªæ¼”å‡ºã‚ˆã‚Šã‚‚ã€è½ã¡ç€ã„ãŸãƒˆãƒ¼ãƒ³ã¨é‡ã¿ã®ã‚ã‚‹ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å¥½ã‚€ã‚¿ã‚¤ãƒ—ã€‚èª­ã¿é€²ã‚ã‚‹ã®ã«å°‘ã—ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒå¿…è¦ã§ã‚‚ã€ãã®ã¶ã‚“èª­å¾Œã«æ·±ã„æº€è¶³æ„Ÿã‚’å¾—ã‚„ã™ã„ã€‚ãƒŸã‚¹ãƒ†ãƒªã‚„ç¤¾ä¼šæ´¾ã€å¿ƒç†æå†™ã®æ¿ƒã„ä½œå“ãªã©ã€ã€Œè…°ã‚’æ®ãˆã¦å‘ãåˆã†ä¸€å†Šã€ã¨ã®ç¸ãŒå¼·ã„ã€‚";
      } else {
        desc = "æ„Ÿæƒ…ãƒ»ä¸–ç•Œè¦³ãƒ»æ§‹æˆã®ã©ã‚Œã‹ä¸€ã¤ã«åã‚Šã™ããªã„ã€ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ©ãƒ«ãªèª­æ›¸æ°—è³ªã€‚è©±é¡Œä½œãƒ»æ˜ åƒåŒ–ä½œå“ãƒ»å®šç•ªå°èª¬ãªã©ã€ã¾ãšã¯ã„ã‚ã„ã‚è§¦ã‚Œã¦ã¿ã‚‹ã“ã¨ã§ã€Œè‡ªåˆ†ã®å¥½ããªå‚¾å‘ã€ãŒè‡ªç„¶ã¨è¦‹ãˆã¦ãã‚‹ã‚¿ã‚¤ãƒ—ã€‚è¨ºæ–­çµæœã‚’ãã£ã‹ã‘ã«ã€æ–°ã—ã„ã‚¸ãƒ£ãƒ³ãƒ«ã‚’è©¦ã—ã¦ã¿ã‚‹ã®ã‚‚ãŠã™ã™ã‚ã€‚";
      }

      const tags = [];
      if (emotionScore >= 2) tags.push("#æ„Ÿæƒ…ç§»å…¥é‡è¦–");
      if (emotionScore <= -2) tags.push("#æ€è€ƒæ´¾èª­è€…");
      if (worldScore >= 2) tags.push("#éæ—¥å¸¸ãŒå¥½ã");
      if (worldScore <= -2) tags.push("#ç¾å®Ÿå¯„ã‚Šã‚¹ãƒˆãƒ¼ãƒªãƒ¼");
      if (tempoScore >= 2) tags.push("#ãƒ†ãƒ³ãƒé‡è¦–");
      if (tempoScore <= -2) tags.push("#ã˜ã£ãã‚Šæ´¾");
      if (tags.length === 0) tags.push("#ãƒãƒ©ãƒ³ã‚¹å‹èª­æ›¸ã‚¿ã‚¤ãƒ—");

      return { typeName, desc, tags, total };
    }

    // çµæœè¡¨ç¤º
    function showResult() {
      screenQuestion.style.display = "none";
      screenResult.style.display = "block";
      progressInner.style.width = "100%";

      const info = getTypeInfo(answers);
      currentTypeInfo = info;
      resultType.textContent = info.typeName;
      resultDesc.textContent = info.desc;

      const shifted = info.total + 22;
      const index = ((shifted % books.length) + books.length) % books.length;
      const book = books[index];
      currentBook = book;

      recBookTitle.textContent = `ãŠã™ã™ã‚ã®ä¸€å†Šï¼š${book.title}`;
      recBookAuthor.textContent = `è‘—è€…ï¼š${book.author}`;
      recBookIsbn.textContent = `ISBNï¼š${book.isbn}`;

      recTags.innerHTML = "";
      info.tags.forEach(t => {
        const span = document.createElement("span");
        span.className = "tag-pill";
        span.textContent = t;
        recTags.appendChild(span);
      });

      // è¡¨ç´™ç”»åƒèª­ã¿è¾¼ã¿
      loadCoverForISBN(book.isbn);
    }

    // Google Books APIã‹ã‚‰è¡¨ç´™ã¨æƒ…å ±ã‚’å–å¾—
    async function loadCoverForISBN(isbn) {
      recBookCoverImg.style.display = "none";
      recBookCoverFallback.style.display = "flex";
      modalCoverImg.style.display = "none";

      currentBookDetail = null;

      try {
        const url = `https://www.googleapis.com/books/v1/volumes?q=isbn:${encodeURIComponent(isbn)}`;
        const res = await fetch(url);
        if (!res.ok) return;
        const data = await res.json();
        if (!data.items || !data.items.length) return;

        const volume = data.items[0].volumeInfo || {};
        const imageLinks = volume.imageLinks || {};
        let thumb = imageLinks.extraLarge || imageLinks.large || imageLinks.medium || imageLinks.thumbnail || imageLinks.smallThumbnail;

        if (thumb) {
          // httpâ†’httpsã«æƒãˆã‚‹
          thumb = thumb.replace(/^http:/, "https:");
          recBookCoverImg.src = thumb;
          recBookCoverImg.style.display = "block";
          recBookCoverFallback.style.display = "none";

          modalCoverImg.src = thumb;
          modalCoverImg.style.display = "block";

          shareBookCoverImg.src = thumb;
        }

        currentBookDetail = {
          publisher: volume.publisher || "",
          publishedDate: volume.publishedDate || "",
          description: volume.description || "",
          cover: thumb || ""
        };
      } catch (e) {
        console.error("Google Books API error", e);
      }
    }

    // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºå‡¦ç†
    function openBookModal() {
      if (!currentBook) return;

      modalTitle.textContent = currentBook.title;
      modalAuthor.textContent = currentBook.author;
      modalIsbn.textContent = currentBook.isbn;

      const pub = currentBookDetail && currentBookDetail.publisher ? currentBookDetail.publisher : "ä¸æ˜";
      const dateRaw = currentBookDetail && currentBookDetail.publishedDate ? currentBookDetail.publishedDate : "";
      let year = "";
      if (dateRaw) {
        year = dateRaw.slice(0,4);
      }
      modalPublisher.textContent = pub;
      modalYear.textContent = year || "ä¸æ˜";

      if (currentBookDetail && currentBookDetail.description) {
        modalDesc.textContent = currentBookDetail.description;
      } else {
        modalDesc.textContent = "æœ¬ç•ªç’°å¢ƒã§ã¯ã€å‡ºç‰ˆç¤¾æƒ…å ±ã‚„ç´¹ä»‹æ–‡ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚";
      }

      if (currentBookDetail && currentBookDetail.cover) {
        modalCoverImg.src = currentBookDetail.cover;
        modalCoverImg.style.display = "block";
      } else if (recBookCoverImg.src) {
        modalCoverImg.src = recBookCoverImg.src;
        modalCoverImg.style.display = "block";
      } else {
        modalCoverImg.style.display = "none";
      }

      const isbnDigits = currentBook.isbn.replace(/-/g, "");
      modalAmazonLink.href = `https://www.amazon.co.jp/s?k=${encodeURIComponent(isbnDigits)}`;

      bookModal.style.display = "flex";
    }
  </script>
</body>
</html>