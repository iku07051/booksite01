<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>èª­æ›¸ã‚¿ã‚¤ãƒ—è¨ºæ–­</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #f7f2ea;
      --card-bg: #ffffff;
      --accent: #7fc7b5;      /* ãƒŸãƒ³ãƒˆ */
      --accent-soft: #c7efe4;
      --accent-strong: #56a896;
      --text-main: #262626;
      --text-sub: #666666;
      --danger: #f28b82;
      --radius-lg: 24px;
      --radius-full: 999px;
      --shadow-soft: 0 10px 30px rgba(0,0,0,0.06);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, system-ui, "Helvetica Neue", "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #ffeef5 0, #f7f2ea 45%, #e8f6f3 100%);
      color: var(--text-main);
    }

    .app {
      max-width: 820px;
      margin: 0 auto;
      padding: 28px 16px 40px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: stretch;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 16px;
    }
    .logo-mark {
      width: 32px;
      height: 32px;
      border-radius: 14px;
      background: linear-gradient(135deg, var(--accent), #ffd6e5);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 700;
      font-size: 18px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.12);
    }
    .logo-text {
      font-size: 0.9rem;
      font-weight: 600;
      letter-spacing: 0.04em;
      color: var(--text-sub);
    }

    .card {
      background: rgba(255,255,255,0.97);
      border-radius: var(--radius-lg);
      padding: 22px 18px 24px;
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(16px);
      animation: fadeIn 0.35s ease-out;
    }

    h1 {
      font-size: 1.8rem;
      margin: 0 0 6px;
      letter-spacing: 0.04em;
    }

    .subtitle {
      color: var(--text-sub);
      font-size: 0.95rem;
      margin-bottom: 18px;
      line-height: 1.6;
    }

    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 18px;
    }
    .badge {
      font-size: 0.75rem;
      padding: 4px 10px;
      border-radius: 999px;
      background: #f0f0f5;
      color: #555;
    }
    .badge.main {
      background: var(--accent-soft);
      color: #155c4e;
      font-weight: 600;
    }

    .button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 11px 22px;
      border-radius: var(--radius-full);
      border: none;
      background: var(--accent);
      color: #fff;
      font-size: 0.98rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.15s ease, background 0.15s ease;
      box-shadow: 0 10px 24px rgba(64, 145, 124, 0.35);
    }
    .button span {
      margin-left: 6px;
      font-size: 1.1rem;
    }
    .button:hover {
      background: var(--accent-strong);
      transform: translateY(-1px) scale(1.01);
      box-shadow: 0 14px 30px rgba(64, 145, 124, 0.4);
    }
    .button:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 6px 16px rgba(64, 145, 124, 0.3);
    }
    .button:disabled {
      background: #c8c8d0;
      box-shadow: none;
      cursor: default;
      transform: none;
    }

    .question-index {
      font-size: 0.85rem;
      color: var(--text-sub);
      margin-bottom: 6px;
    }
    .question-text {
      font-size: 1.1rem;
      font-weight: 650;
      line-height: 1.6;
      margin-bottom: 18px;
    }

    .progress-shell {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }
    .progress-label {
      font-size: 0.8rem;
      color: var(--text-sub);
    }
    .progress-bar {
      flex: 1;
      height: 8px;
      border-radius: var(--radius-full);
      background: #e4e4ec;
      overflow: hidden;
      position: relative;
    }
    .progress-inner {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), #ffc5dd);
      transition: width 0.25s ease-out;
    }

    .choices {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 18px;
    }
    .choice {
      border-radius: var(--radius-full);
      border: 1px solid #e0e0ea;
      padding: 9px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      transition: background 0.15s ease, border-color 0.15s ease, transform 0.08s ease, box-shadow 0.15s ease;
      background: #fafafa;
    }
    .choice-main {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.95rem;
    }
    .choice-pill {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 2px solid #c2c2d0;
      position: relative;
      flex-shrink: 0;
    }
    .choice-pill::after {
      content: "";
      position: absolute;
      left: 50%;
      top: 50%;
      width: 10px;
      height: 10px;
      transform: translate(-50%, -50%) scale(0);
      border-radius: inherit;
      background: var(--accent);
      transition: transform 0.12s ease-out;
    }
    .choice-hint {
      font-size: 0.75rem;
      color: #999;
    }
    .choice.selected {
      background: #ffffff;
      border-color: var(--accent);
      box-shadow: 0 8px 20px rgba(64, 145, 124, 0.15);
      transform: translateY(-1px);
    }
    .choice.selected .choice-pill {
      border-color: var(--accent-strong);
    }
    .choice.selected .choice-pill::after {
      transform: translate(-50%, -50%) scale(1);
    }

    .nav-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .nav-left {
      font-size: 0.82rem;
      color: var(--text-sub);
    }

    .result-title {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 4px;
    }
    .result-type {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 1.05rem;
      font-weight: 650;
      padding: 6px 12px;
      border-radius: var(--radius-full);
      background: var(--accent-soft);
      color: #155c4e;
      margin-bottom: 10px;
    }
    .result-chip-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: linear-gradient(135deg, #ffb7c5, #b39ddb);
    }
    .result-desc {
      font-size: 0.95rem;
      color: var(--text-sub);
      line-height: 1.7;
      margin-bottom: 18px;
    }

    .book-card {
      border-radius: 18px;
      border: 1px solid #eee;
      padding: 14px 14px 12px;
      background: linear-gradient(135deg, #fff, #fff7f3);
      display: flex;
      gap: 10px;
      align-items: flex-start;
      margin-bottom: 12px;
      cursor: pointer;
    }
    .book-card:hover {
      box-shadow: 0 10px 26px rgba(0,0,0,0.12);
      transform: translateY(-1px);
      transition: all 0.15s ease-out;
    }
    .book-thumb {
      width: 42px;
      height: 56px;
      border-radius: 8px;
      background: linear-gradient(135deg, #ffd6e5, #c3f0e2);
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 700;
      color: #555;
      box-shadow: 0 6px 14px rgba(0,0,0,0.18);
    }
    .book-body {
      flex: 1;
    }
    .book-title {
      font-weight: 650;
      margin-bottom: 2px;
      font-size: 0.96rem;
    }
    .book-meta {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 4px;
    }
    .book-isbn {
      font-size: 0.8rem;
      color: #999;
    }

    .tags-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }
    .tag-pill {
      font-size: 0.75rem;
      padding: 3px 10px;
      border-radius: 999px;
      background: #f1ebff;
      color: #5c4a92;
    }

    .restart {
      margin-top: 16px;
      text-align: right;
    }
    .restart .button {
      padding-inline: 18px;
      font-size: 0.9rem;
      box-shadow: 0 6px 18px rgba(0,0,0,0.18);
    }

    .footer-note {
      margin-top: 14px;
      font-size: 0.76rem;
      color: #999;
      text-align: center;
    }

    /* ã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³å‘¨ã‚Š */
    .share-row {
      margin-top: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }
    .share-label {
      font-size: 0.8rem;
      color: var(--text-sub);
    }
    .share-buttons {
      display: flex;
      gap: 8px;
    }
    .share-icon-btn {
      width: 36px;
      height: 36px;
      border-radius: 999px;
      border: none;
      background: #ffffff;
      box-shadow: 0 6px 14px rgba(0,0,0,0.12);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      padding: 0;
      transition: transform 0.08s ease, box-shadow 0.15s ease;
    }
    .share-icon-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.16);
    }
    .share-icon {
      font-size: 1.1rem;
    }

    /* è©³ç´°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
    .overlay-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.35);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    .overlay-content {
      width: min(420px, 92vw);
      max-height: 85vh;
      overflow-y: auto;
      background: rgba(255,255,255,0.98);
      border-radius: 24px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.25);
      padding: 18px 18px 20px;
      backdrop-filter: blur(14px);
      animation: fadeIn 0.2s ease-out;
    }
    .overlay-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .overlay-title {
      font-size: 1rem;
      font-weight: 650;
      margin-right: 8px;
    }
    .overlay-close {
      background: transparent;
      border: none;
      font-size: 1.3rem;
      cursor: pointer;
      color: #888;
    }
    .overlay-close:hover {
      color: #444;
    }
    .overlay-meta {
      font-size: 0.85rem;
      color: var(--text-sub);
      margin-bottom: 8px;
    }
    .overlay-isbn {
      font-size: 0.8rem;
      color: #999;
      margin-bottom: 10px;
    }
    .overlay-section-title {
      font-size: 0.82rem;
      font-weight: 600;
      color: #444;
      margin: 10px 0 4px;
    }
    .overlay-attrs {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
    }
    .overlay-attr-pill {
      font-size: 0.76rem;
      padding: 3px 9px;
      border-radius: 999px;
      background: #f4f4fb;
      color: #555;
    }
    .overlay-note {
      font-size: 0.8rem;
      color: #777;
      line-height: 1.6;
    }

    @media (min-width: 768px) {
      .card {
        padding: 26px 26px 28px;
      }
      h1 {
        font-size: 2rem;
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(6px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="logo">
      <div class="logo-mark">B</div>
      <div class="logo-text">Book Personality Lab</div>
    </div>

    <!-- START SCREEN -->
    <div id="screen-start" class="card">
      <h1>èª­æ›¸ã‚¿ã‚¤ãƒ—è¨ºæ–­</h1>
      <p class="subtitle">
        11ã®è³ªå•ã«ç›´æ„Ÿã§ã“ãŸãˆã‚‹ã ã‘ã§ã€<br />
        ã‚ãªãŸã®ã€Œèª­æ›¸æ°—è³ªã€ã¨ã€ã„ã¾ã®ã‚ãªãŸã«ã„ã¡ã°ã‚“è¿‘ã„ä¸€å†ŠãŒã‚ã‹ã‚Šã¾ã™ã€‚
      </p>

      <div class="badge-row">
        <span class="badge main">æœ¬ã¨ã®ãƒŸã‚¹ãƒãƒƒãƒã‚’ãªãã™ãŸã‚ã®è¨ºæ–­</span>
        <span class="badge">è¨ºæ–­æ™‚é–“ï¼š3åˆ†</span>
        <span class="badge">å…¨11å• / 4æŠ</span>
      </div>

      <button class="button" id="startButton">
        è¨ºæ–­ã‚’ã¯ã˜ã‚ã‚‹ <span>â–¶</span>
      </button>

      <div class="footer-note">
        â€»ã“ã‚Œã¯ä¼ç”»ç”¨ã®ãƒ¢ãƒƒã‚¯ç”»é¢ã§ã™ã€‚æœ¬ç•ªã§ã¯çµæœã‚¿ã‚¤ãƒ—æ•°ãƒ»æ¨å¥¨ä½œå“ã®ç²¾åº¦ãŒã•ã‚‰ã«ä¸ŠãŒã‚Šã¾ã™ã€‚
      </div>
    </div>

    <!-- QUESTION SCREEN -->
    <div id="screen-question" class="card" style="display:none;">
      <div class="progress-shell">
        <span class="progress-label" id="progressLabel">è³ªå• 1 / 11</span>
        <div class="progress-bar">
          <div class="progress-inner" id="progressInner"></div>
        </div>
      </div>

      <div class="question-index" id="questionCounter"></div>
      <div class="question-text" id="questionText"></div>

      <div class="choices" id="choicesContainer"></div>

      <div class="nav-row">
        <div class="nav-left" id="hintText">æ·±ãè€ƒãˆè¾¼ã¾ãšã€æœ€åˆã®ç›´æ„Ÿã§å¤§ä¸ˆå¤«ã€‚</div>
        <button class="button" id="nextButton" disabled>æ¬¡ã¸</button>
      </div>
    </div>

    <!-- RESULT SCREEN -->
    <div id="screen-result" class="card" style="display:none;">
      <div class="result-title">è¨ºæ–­çµæœ</div>
      <div class="result-type">
        <span class="result-chip-dot"></span>
        <span id="resultType"></span>
      </div>
      <div class="result-desc" id="resultDesc"></div>

      <div class="book-card" id="bookCard">
        <div class="book-thumb" id="bookThumb">
          æœ¬
        </div>
        <div class="book-body">
          <div class="book-title" id="recBookTitle"></div>
          <div class="book-meta" id="recBookAuthor"></div>
          <div class="book-isbn" id="recBookIsbn"></div>
          <div class="tags-row" id="recTags"></div>
        </div>
      </div>

      <div class="share-row">
        <div class="share-label">çµæœã‚’ã‚·ã‚§ã‚¢ã™ã‚‹</div>
        <div class="share-buttons">
          <button class="share-icon-btn" id="shareXBtn" aria-label="Xã§ã‚·ã‚§ã‚¢">
            <span class="share-icon">ğ•</span>
          </button>
          <button class="share-icon-btn" id="shareInstaBtn" aria-label="Instagramã§ã‚·ã‚§ã‚¢">
            <span class="share-icon">ğŸ“¸</span>
          </button>
        </div>
      </div>

      <div class="restart">
        <button class="button" id="restartButton">ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹</button>
      </div>

      <div class="footer-note">
        â€» æ¨è–¦ã¯ãƒ¢ãƒƒã‚¯ç”¨ã®ç°¡æ˜“ãƒ­ã‚¸ãƒƒã‚¯ã§ã™ã€‚æœ¬ç•ªã§ã¯èª­æ›¸ã‚¿ã‚¤ãƒ— Ã— ã‚¸ãƒ£ãƒ³ãƒ«å¥½ã¿ Ã— åª’ä½“å—œå¥½ã‹ã‚‰ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ã•ã‚Œã¾ã™ã€‚
      </div>
    </div>
  </div>

  <!-- æœ¬ã®è©³ç´°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
  <div class="overlay-backdrop" id="detailOverlay">
    <div class="overlay-content">
      <div class="overlay-header">
        <div class="overlay-title" id="detailTitle"></div>
        <button class="overlay-close" id="detailCloseBtn" aria-label="é–‰ã˜ã‚‹">Ã—</button>
      </div>
      <div class="overlay-meta" id="detailMeta"></div>
      <div class="overlay-isbn" id="detailIsbn"></div>

      <div class="overlay-section-title">ã“ã®æœ¬ã®èª­ã¿å‘³</div>
      <div class="overlay-attrs" id="detailAttrs"></div>

      <div class="overlay-section-title">ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯æ¤œç´¢</div>
      <div class="overlay-attrs">
        <a id="detailSearchLink" class="overlay-attr-pill" target="_blank" rel="noopener noreferrer">
          æ›¸åï¼‹ISBNã§æ¤œç´¢ã™ã‚‹
        </a>
      </div>

      <p class="overlay-note">
        â€» ã“ã®è©³ç´°ã¯ä¼ç”»ç”¨ã®ç°¡æ˜“æƒ…å ±ã§ã™ã€‚<br/>
        å®Ÿéš›ã®ç´¹ä»‹ãƒšãƒ¼ã‚¸ã§ã¯ã€ã‚ã‚‰ã™ã˜ãƒ»ã‚¿ãƒ¼ã‚²ãƒƒãƒˆèª­è€…ãƒ»ãƒœãƒªãƒ¥ãƒ¼ãƒ æ„Ÿãªã©ã‚’æ²è¼‰ã§ãã¾ã™ã€‚
      </p>
    </div>
  </div>

  <script>
    // =========================
    // è³ªå•ï¼ˆæ–­å®šèª¿ãƒ»11å•ï¼‰â€»å…ƒã®ã¾ã¾
    // =========================
    const questions = [
      "ç‰©èªã‚ˆã‚Šã‚‚ã€çŸ¥è­˜ã‚„æƒ…å ±ãŒæ‰‹ã«å…¥ã‚‹ä½œå“ã‚’é¸ã³ãŒã¡ã ã€‚",
      "ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®æ„Ÿæƒ…ã«å¼·ãå…±é³´ã—ãªãŒã‚‰èª­ã‚€ã»ã†ã ã€‚",
      "ãƒ†ãƒ³ãƒã‚ˆãä¸€æ°—ã«èª­ã¿é€²ã‚ã‚‰ã‚Œã‚‹ä½œå“ã‚’æœ€å„ªå…ˆã™ã‚‹ã»ã†ã ã€‚",
      "èª­ã¿çµ‚ã‚ã‚‹ã¾ã§æ™‚é–“ãŒã‹ã‹ã£ã¦ã‚‚ã€é‡åšãªç‰©èªã®ã»ã†ã«æº€è¶³ã‚’æ„Ÿã˜ã‚‹ã»ã†ã ã€‚",
      "ç¾å®Ÿã®å»¶é•·ç·šä¸Šã«ã‚ã‚‹ã€ãƒªã‚¢ãƒ«ãªé¡Œæã®ç‰©èªãŒåˆºã•ã‚Šã‚„ã™ã„ã»ã†ã ã€‚",
      "ç¾å®Ÿé›¢ã‚Œã—ãŸè¨­å®šã‚„ä¸–ç•Œè¦³ã«ã©ã£ã·ã‚Šæµ¸ã‹ã‚Œã‚‹ç‰©èªã«æƒ¹ã‹ã‚Œã‚‹ã»ã†ã ã€‚",
      "ã€ŒãŠã‚‚ã—ã‚ã„ã€ã‚ˆã‚Šã‚‚ã€Œãªã«ã‹ã‚’è€ƒãˆã•ã›ã¦ãã‚Œã‚‹ä½œå“ã€ã‚’æ±‚ã‚ã‚‹ã»ã†ã ã€‚",
      "çŸ­æ™‚é–“ã§èª­ã¿åˆ‡ã‚Œã‚‹ä½œå“ã‚ˆã‚Šã€æ™‚é–“ã‚’ã‹ã‘ã¦æµ¸ã‚‹ä½œå“ãŒå‘ã„ã¦ã„ã‚‹ã»ã†ã ã€‚",
      "ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®å¿ƒã®å‹•ããŒã¦ã„ã­ã„ã«æã‹ã‚ŒãŸä½œå“ã«ä¾¡å€¤ã‚’æ„Ÿã˜ã‚‹ã»ã†ã ã€‚",
      "ä¼ç·šå›åã‚„æ§‹é€ ã®ç·»å¯†ã•ãŒã€ä½œå“é¸ã³ã®æ±ºã‚æ‰‹ã«ãªã‚Šã‚„ã™ã„ã»ã†ã ã€‚",
      "èª­ã¿çµ‚ã‚ã£ãŸã‚ã¨ã€èª°ã‹ã¨æ„Ÿæƒ³ã‚’å…±æœ‰ã—ãŸããªã‚‹ã“ã¨ãŒå¤šã„ã»ã†ã ã€‚"
    ];

    // 4æŠï¼ˆã‚¹ã‚³ã‚¢ç”¨ã®å€¤ã‚‚ä»˜ä¸ï¼‰
    const choices = [
      { label: "ã¯ã„", value: 2, hint: "ã‹ãªã‚Šå½“ã¦ã¯ã¾ã‚‹" },
      { label: "ã©ã¡ã‚‰ã‹ã¨ã„ãˆã°ã¯ã„", value: 1, hint: "ãªã‚“ã¨ãªãå½“ã¦ã¯ã¾ã‚‹" },
      { label: "ã©ã¡ã‚‰ã‹ã¨ã„ãˆã°ã„ã„ãˆ", value: -1, hint: "ã‚ã¾ã‚Šå½“ã¦ã¯ã¾ã‚‰ãªã„" },
      { label: "ã„ã„ãˆ", value: -2, hint: "ã¾ã£ãŸãå½“ã¦ã¯ã¾ã‚‰ãªã„" }
    ];

    // =========================
    // ä½œå“ãƒ‡ãƒ¼ã‚¿ï¼ˆ80å†Šï¼‰ï¼‹ å±æ€§
    // =========================
    const books = [
      { id:1,  title:"medium éœŠåª’æ¢åµåŸå¡šç¿¡ç¿ ", author:"ç›¸æ²¢æ²™å‘¼", isbn:"978-4065170946", meta:{purpose:"story", category:"mystery", tempo:"medium", world:"mixed", emotion:"medium", difficulty:"normal"} },
      { id:2,  title:"invert åŸå¡šç¿¡ç¿ å€’å™é›†", author:"ç›¸æ²¢æ²™å‘¼", isbn:"978-4065237328", meta:{purpose:"story", category:"mystery", tempo:"medium", world:"mixed", emotion:"medium", difficulty:"normal"} },
      { id:3,  title:"invert â…¡ è¦—ãçª“ã®æ­»è§’", author:"ç›¸æ²¢æ²™å‘¼", isbn:"978-4065286388", meta:{purpose:"story", category:"mystery", tempo:"medium", world:"mixed", emotion:"medium", difficulty:"normal"} },
      { id:4,  title:"å°èª¬ã®ç¥æ§˜", author:"ç›¸æ²¢æ²™å‘¼", isbn:"978-4062940344", meta:{purpose:"story", category:"human", tempo:"medium", world:"real", emotion:"high", difficulty:"normal"} },
      { id:5,  title:"ã“ã®é…ä¿¡ã¯çµ‚äº†ã—ã¾ã—ãŸ", author:"é’æœ¨é›ªå¹³", isbn:"978-4575248197", meta:{purpose:"story", category:"suspense", tempo:"fast", world:"real", emotion:"medium", difficulty:"easy"} },
      { id:6,  title:"æš—é»’å°‘å¥³", author:"ç§‹å‰ç†é¦™å­", isbn:"978-4575238259", meta:{purpose:"story", category:"suspense", tempo:"medium", world:"real", emotion:"high", difficulty:"normal"} },
      { id:7,  title:"è‡ªæ®ºäºˆå®šæ—¥", author:"ç§‹å‰ç†é¦™å­", isbn:"978-4488418212", meta:{purpose:"story", category:"suspense", tempo:"medium", world:"real", emotion:"high", difficulty:"normal"} },
      { id:8,  title:"æ­£æ¬²", author:"æœäº•ãƒªãƒ§ã‚¦", isbn:"978-4-10-126933-7", meta:{purpose:"story", category:"drama", tempo:"slow", world:"real", emotion:"high", difficulty:"hard"} },
      { id:9,  title:"ä½•è€…", author:"æœäº•ãƒªãƒ§ã‚¦", isbn:"978-4-10-126931-3", meta:{purpose:"story", category:"drama", tempo:"medium", world:"real", emotion:"high", difficulty:"normal"} },
      { id:10, title:"æ¡å³¶ã€éƒ¨æ´»ã‚„ã‚ã‚‹ã£ã¦ã‚ˆ", author:"æœäº•ãƒªãƒ§ã‚¦", isbn:"978-4-08-771335-0", meta:{purpose:"story", category:"human", tempo:"medium", world:"real", emotion:"high", difficulty:"easy"} },
      { id:11, title:"ç”Ÿæ®–è¨˜", author:"æœäº•ãƒªãƒ§ã‚¦", isbn:"978-4-09-386730-6", meta:{purpose:"story", category:"drama", tempo:"slow", world:"real", emotion:"medium", difficulty:"hard"} },
      { id:12, title:"ä¸–ã«ã‚‚å¥‡å¦™ãªå›ç‰©èª", author:"æœäº•ãƒªãƒ§ã‚¦", isbn:"978-4-06-219824-0", meta:{purpose:"story", category:"mystery", tempo:"medium", world:"mixed", emotion:"medium", difficulty:"normal"} },
      { id:13, title:"æ­¦é“é¤¨", author:"æœäº•ãƒªãƒ§ã‚¦", isbn:"978-4-06-219824-0", meta:{purpose:"story", category:"drama", tempo:"medium", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:14, title:"ã©ã†ã—ã¦ã‚‚ç”Ÿãã¦ã‚‹", author:"æœäº•ãƒªãƒ§ã‚¦", isbn:"978-4-34-403516-4", meta:{purpose:"story", category:"human", tempo:"medium", world:"real", emotion:"high", difficulty:"normal"} },
      { id:15, title:"ä¿ºã§ã¯ãªã„ç‚ä¸Š", author:"æµ…å€‰ç§‹æˆ", isbn:"978-4-57-552758-2", meta:{purpose:"story", category:"suspense", tempo:"fast", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:16, title:"6äººã®å˜˜ã¤ããªå¤§å­¦ç”Ÿ", author:"æµ…å€‰ç§‹æˆ", isbn:"978-4041098790", meta:{purpose:"story", category:"mystery", tempo:"fast", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:17, title:"å®¶æ—è§£æ•£ã¾ã§åƒã‚­ãƒ­ãƒ¡ãƒ¼ãƒˆãƒ«", author:"æµ…å€‰ç§‹æˆ", isbn:"978-4041145647", meta:{purpose:"story", category:"human", tempo:"medium", world:"real", emotion:"high", difficulty:"normal"} },
      { id:18, title:"å˜˜ã¨éš£äºº", author:"èŠ¦æ²¢å¤®", isbn:"978-4163919713", meta:{purpose:"story", category:"suspense", tempo:"medium", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:19, title:"è¨±ã•ã‚Œã‚ˆã†ã¨ã¯æ€ã„ã¾ã›ã‚“", author:"èŠ¦æ²¢å¤®", isbn:"9784101014319", meta:{purpose:"story", category:"drama", tempo:"medium", world:"real", emotion:"high", difficulty:"normal"} },
      { id:20, title:"æ®ºæˆ®ã«ã„ãŸã‚‹ç—…", author:"æˆ‘å­«å­æ­¦ä¸¸", isbn:"978-4041145647", meta:{purpose:"story", category:"mystery", tempo:"medium", world:"real", emotion:"high", difficulty:"normal"} },
      { id:21, title:"ä¿®ç¾…ã®å®¶", author:"æˆ‘å­«å­æ­¦ä¸¸", isbn:"978-4-065-32461-5", meta:{purpose:"story", category:"suspense", tempo:"fast", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:22, title:"ï¼ã®æ®ºäºº", author:"æˆ‘å­«å­æ­¦ä¸¸", isbn:"978-4-061-85227-3", meta:{purpose:"story", category:"mystery", tempo:"medium", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:23, title:"ç®±ç”·", author:"å®‰å€å·¥æˆ¿", isbn:"978-4-101-12116-1", meta:{purpose:"story", category:"drama", tempo:"slow", world:"real", emotion:"medium", difficulty:"hard"} },
      { id:24, title:"åè§’é¤¨ã®æ®ºäºº", author:"ç¶¾è¾»è¡Œäºº", isbn:"978-4-06-275857-4", meta:{purpose:"story", category:"mystery", tempo:"medium", world:"mixed", emotion:"medium", difficulty:"normal"} },
      { id:25, title:"ãã¾ã™ã‘ã¨ä¸€ç·’ã«", author:"æ–°äº•ç´ å­", isbn:"978-4-12-207599-3", meta:{purpose:"story", category:"fantasy", tempo:"medium", world:"mixed", emotion:"medium", difficulty:"easy"} },
      { id:26, title:"ã‚ˆã†ã“ãã€æˆ‘ãŒå®¶ã¸", author:"æ± äº•æˆ¸æ½¤", isbn:"978-4-09-408843-4", meta:{purpose:"story", category:"suspense", tempo:"medium", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:27, title:"ä¿ºãŸã¡ãƒãƒ–ãƒ«å…¥è¡Œçµ„", author:"æ± äº•æˆ¸æ½¤", isbn:"978-4-16-323600-1", meta:{purpose:"story", category:"business", tempo:"medium", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:28, title:"ä¸‹ç”ºãƒ­ã‚±ãƒƒãƒˆ", author:"æ± äº•æˆ¸æ½¤", isbn:"978-4-09-408896-0", meta:{purpose:"story", category:"business", tempo:"medium", world:"real", emotion:"high", difficulty:"normal"} },
      { id:29, title:"ã‚·ãƒ£ã‚¤ãƒ­ãƒƒã‚¯ã®å­ä¾›ãŸã¡", author:"æ± äº•æˆ¸æ½¤", isbn:"978-4-16-324630-7", meta:{purpose:"story", category:"suspense", tempo:"medium", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:30, title:"æ°‘ç‹", author:"æ± äº•æˆ¸æ½¤", isbn:"978-4-59-111662-3", meta:{purpose:"story", category:"drama", tempo:"medium", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:31, title:"ãƒãƒ¤ãƒ–ã‚µæ¶ˆé˜²å›£", author:"æ± äº•æˆ¸æ½¤", isbn:"978-4-08-744767-5", meta:{purpose:"story", category:"mystery", tempo:"medium", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:32, title:"ã‚¢ã‚­ãƒ©ã¨ã‚ãã‚‰", author:"æ± äº•æˆ¸æ½¤", isbn:"978-4-19-894230-4", meta:{purpose:"story", category:"business", tempo:"medium", world:"real", emotion:"high", difficulty:"normal"} },
      { id:33, title:"ä¸ƒã¤ã®ä¼šè­°", author:"æ± äº•æˆ¸æ½¤", isbn:"978-4-08-745412-3", meta:{purpose:"story", category:"business", tempo:"medium", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:34, title:"ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ»ã‚²ãƒ¼ãƒ ", author:"æ± äº•æˆ¸æ½¤", isbn:"978-4-06-529910-4", meta:{purpose:"story", category:"business", tempo:"medium", world:"real", emotion:"high", difficulty:"normal"} },
      { id:35, title:"ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¹ãƒ©ãƒ³ãƒãƒ¼", author:"ä¼Šå‚å¹¸å¤ªéƒ", isbn:"978-4-10-125026-7", meta:{purpose:"story", category:"suspense", tempo:"fast", world:"real", emotion:"high", difficulty:"normal"} },
      { id:36, title:"ã‚°ãƒ©ã‚¹ãƒ›ãƒƒãƒ‘ãƒ¼", author:"ä¼Šå‚å¹¸å¤ªéƒ", isbn:"978-4-16-324630-7", meta:{purpose:"story", category:"suspense", tempo:"fast", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:37, title:"é­”ç‹", author:"ä¼Šå‚å¹¸å¤ªéƒ", isbn:"978-4-06-213146-9", meta:{purpose:"story", category:"suspense", tempo:"medium", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:38, title:"å¨¼å¹´", author:"çŸ³ç”°è¡£è‰¯", isbn:"978-4-08-747694-1", meta:{purpose:"story", category:"drama", tempo:"medium", world:"real", emotion:"high", difficulty:"normal"} },
      { id:39, title:"æ± è¢‹ã‚¦ã‚¨ã‚¹ãƒˆã‚²ãƒ¼ãƒˆãƒ‘ãƒ¼ã‚¯", author:"çŸ³ç”°è¡£è‰¯", isbn:"978-4-16-717403-3", meta:{purpose:"story", category:"drama", tempo:"fast", world:"real", emotion:"medium", difficulty:"easy"} },
      { id:40, title:"ã„ã¾ã€ä¼šã„ã«ã‚†ãã¾ã™", author:"å¸‚å·æ‹“å¸", isbn:"978-4-09-408217-3", meta:{purpose:"story", category:"romance", tempo:"medium", world:"real", emotion:"high", difficulty:"easy"} },
      { id:41, title:"å¤«æ‹æ®ºã€€ã¤ã¾ã”ã„ã”ã‚ã—", author:"é­šå´ä¾çŸ¥å­", isbn:"978-4041147474", meta:{purpose:"story", category:"suspense", tempo:"medium", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:42, title:"æ™‚è¨ˆã¯äºŒåº¦ã¨å‡ã‚‰ãªã„", author:"é­šå´ä¾çŸ¥å­", isbn:"978-4863114609", meta:{purpose:"story", category:"suspense", tempo:"medium", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:43, title:"å¤‰ãªå®¶", author:"é›¨ç©´", isbn:"978-4864108454", meta:{purpose:"story", category:"mystery", tempo:"fast", world:"real", emotion:"medium", difficulty:"easy"} },
      { id:44, title:"å¤‰ãªçµµ", author:"é›¨ç©´", isbn:"978-4575528138", meta:{purpose:"story", category:"mystery", tempo:"fast", world:"real", emotion:"medium", difficulty:"easy"} },
      { id:45, title:"å¤‰ãªå®¶2", author:"é›¨ç©´", isbn:"978-4864109826", meta:{purpose:"story", category:"mystery", tempo:"fast", world:"real", emotion:"medium", difficulty:"easy"} },
      { id:46, title:"å¤‰ãªåœ°å›³", author:"é›¨ç©´", isbn:"978-4575248104", meta:{purpose:"story", category:"mystery", tempo:"fast", world:"real", emotion:"medium", difficulty:"easy"} },
      { id:47, title:"æ¡œã®ã‚ˆã†ãªåƒ•ã®æ‹äºº", author:"å®‡å±±ä½³ç¥", isbn:"978-4087455489", meta:{purpose:"story", category:"romance", tempo:"medium", world:"real", emotion:"high", difficulty:"easy"} },
      { id:48, title:"ã“ã®æ‹ã¯ä¸–ç•Œã§ã„ã¡ã°ã‚“ç¾ã—ã„é›¨", author:"å®‡å±±ä½³ç¥", isbn:"978-4087442571", meta:{purpose:"story", category:"romance", tempo:"medium", world:"real", emotion:"high", difficulty:"easy"} },
      { id:49, title:"æ‹ã«ç„¦ãŒã‚ŒãŸãƒ–ãƒ«ãƒ¼ï¼¾", author:"å®‡å±±ä½³ç¥", isbn:"978-4087445220", meta:{purpose:"story", category:"romance", tempo:"medium", world:"real", emotion:"high", difficulty:"easy"} },
      { id:50, title:"ã²ã¾ã‚ã‚Šã¯æ‹ã®å½¢", author:"å®‡å±±ä½³ç¥", isbn:"978-4093866392", meta:{purpose:"story", category:"romance", tempo:"medium", world:"real", emotion:"high", difficulty:"easy"} },
      { id:51, title:"ãªãœã©ã†ã®å‰£ã¾ã§ã—ã‹å£²ã‚‰ãªã„ã‚“ã§ã™ã‹ï¼Ÿ", author:"ã‚¨ãƒ•", isbn:"978-4408537740", meta:{purpose:"learning", category:"business", tempo:"medium", world:"real", emotion:"low", difficulty:"normal"} },
      { id:52, title:"æ¨ã—ã®æ®ºäºº", author:"é è—¤ã‹ãŸã‚‹", isbn:"978-4299051134", meta:{purpose:"story", category:"mystery", tempo:"fast", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:53, title:"ï¼ƒãƒãƒ³ãƒ›ãƒ¼ãƒ«", author:"å²¡ç”°é“å°š", isbn:"978-4299039170", meta:{purpose:"story", category:"suspense", tempo:"fast", world:"real", emotion:"medium", difficulty:"easy"} },
      { id:54, title:"ç·‘ã®æˆ‘ãŒå®¶", author:"å°é‡ä¸ç”±ç¾", isbn:"978-4041127506", meta:{purpose:"story", category:"suspense", tempo:"medium", world:"mixed", emotion:"medium", difficulty:"normal"} },
      { id:55, title:"ãƒãƒ¼ãƒ ãƒ»ãƒãƒã‚¹ã‚¿ã®æ „å…‰", author:"æµ·å ‚å°Š", isbn:"978-4796650793", meta:{purpose:"story", category:"mystery", tempo:"medium", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:56, title:"ãƒ–ãƒ©ãƒƒã‚¯ãƒšã‚¢ãƒ³1988", author:"æµ·å ‚å°Š", isbn:"978-4062142540", meta:{purpose:"story", category:"mystery", tempo:"medium", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:57, title:"å…«æ—¥ç›®ã®è‰", author:"è§’ç”°å…‰ä»£", isbn:"978-4122054257", meta:{purpose:"story", category:"drama", tempo:"medium", world:"real", emotion:"high", difficulty:"normal"} },
      { id:58, title:"å¯¾å²¸ã®å½¼å¥³", author:"è§’ç”°å…‰ä»£", isbn:"978-4167672058", meta:{purpose:"story", category:"drama", tempo:"medium", world:"real", emotion:"high", difficulty:"normal"} },
      { id:59, title:"ã‚ªãƒ«ã‚¿ãƒãƒ¼ãƒˆ", author:"åŠ è—¤ã‚·ã‚²ã‚¢ã‚­", isbn:"978-4103537311", meta:{purpose:"story", category:"human", tempo:"medium", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:60, title:"ãƒ”ãƒ³ã‚¯ã¨ã‚°ãƒ¬ãƒ¼", author:"åŠ è—¤ã‚·ã‚²ã‚¢ã‚­", isbn:"978-4087447309", meta:{purpose:"story", category:"drama", tempo:"medium", world:"real", emotion:"high", difficulty:"normal"} },
      { id:61, title:"ãªã‚Œã®ã¯ã¦", author:"åŠ è—¤ã‚·ã‚²ã‚¢ã‚­", isbn:"978-4065331439", meta:{purpose:"story", category:"drama", tempo:"medium", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:62, title:"è›‡ã«ãƒ”ã‚¢ã‚¹", author:"é‡‘åŸã²ã¨ã¿", isbn:"978-4087460483", meta:{purpose:"story", category:"drama", tempo:"medium", world:"real", emotion:"high", difficulty:"normal"} },
      { id:63, title:"ãƒŸãƒ¼ãƒ„ãƒ»ã‚¶ãƒ»ãƒ¯ãƒ¼ãƒ«ãƒ‰", author:"é‡‘åŸã²ã¨ã¿", isbn:"978-4087447309", meta:{purpose:"story", category:"drama", tempo:"medium", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:64, title:"é»„è‰²ã„å®¶", author:"å·ä¸Š æœªæ˜ å­", isbn:"978-4120056284", meta:{purpose:"story", category:"drama", tempo:"slow", world:"real", emotion:"medium", difficulty:"hard"} },
      { id:65, title:"å˜˜ã¤ããªç§ã¨ã€ç´«ã®ç³", author:"ç¥æˆ¸é¥çœŸ", isbn:"978-4867165348", meta:{purpose:"story", category:"romance", tempo:"medium", world:"real", emotion:"high", difficulty:"easy"} },
      { id:66, title:"å…¨èƒ½ã®ã‚«ãƒŸãƒŠ", author:"å–œå¤šå–œä¹…", isbn:"978-4302100071", meta:{purpose:"story", category:"fantasy", tempo:"fast", world:"fantasy", emotion:"medium", difficulty:"normal"} },
      { id:67, title:"ï¼‘ãƒªãƒƒãƒˆãƒ«ã®æ¶™", author:"æœ¨è—¤äºœä¹Ÿ", isbn:"978-4-344-40610-0", meta:{purpose:"growth", category:"essay", tempo:"medium", world:"real", emotion:"high", difficulty:"easy"} },
      { id:68, title:"äºŒäººä¸€çµ„ã«ãªã£ã¦ãã ã•ã„", author:"æœ¨çˆ¾ãƒãƒ¬ãƒ³", isbn:"978-4575247688", meta:{purpose:"story", category:"drama", tempo:"medium", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:69, title:"ç¥ã«æ„›ã•ã‚Œã¦ã„ãŸ", author:"æœ¨çˆ¾ãƒãƒ¬ãƒ³", isbn:"978-4408538402", meta:{purpose:"story", category:"drama", tempo:"medium", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:70, title:"ã¿ã‚“ãªè›ã‚’æ®ºã—ãŸã‹ã£ãŸ", author:"æœ¨çˆ¾ãƒãƒ¬ãƒ³", isbn:"978-4576211015", meta:{purpose:"story", category:"drama", tempo:"medium", world:"real", emotion:"high", difficulty:"normal"} },
      { id:71, title:"æ­»åˆ‘ã«ã„ãŸã‚‹ç—…", author:"æ«›æœ¨ç†å®‡", isbn:"978-4150313005", meta:{purpose:"story", category:"mystery", tempo:"medium", world:"real", emotion:"high", difficulty:"normal"} },
      { id:72, title:"æ®ºäººä¾å­˜ç—‡", author:"æ«›æœ¨ç†å®‡", isbn:"978-4344430259", meta:{purpose:"story", category:"suspense", tempo:"medium", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:73, title:"å¾©è®ã®æ³¥æ²¼", author:"ãã‚ãŒãã‚ã‚†", isbn:"978-4299057587", meta:{purpose:"story", category:"suspense", tempo:"fast", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:74, title:"ãƒ¬ãƒ¢ãƒ³ã¨æ®ºäººé¬¼", author:"ãã‚ãŒãã‚ã‚†", isbn:"978-4299041678", meta:{purpose:"story", category:"mystery", tempo:"fast", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:75, title:"çˆ†å¼¾", author:"å‘‰ å‹æµ©", isbn:"978-4065273470", meta:{purpose:"story", category:"suspense", tempo:"fast", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:76, title:"ã‚¹ãƒ¯ãƒ³", author:"å‘‰ å‹æµ©", isbn:"978-4041127575", meta:{purpose:"story", category:"mystery", tempo:"medium", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:77, title:"è¨˜æ†¶å–ªå¤±ã®å›ã¨ã€å›ã ã‘ã‚’å¿˜ã‚Œã¦ã—ã¾ã£ãŸåƒ•ã€‚", author:"å°é³¥å±…ã»ãŸã‚‹", isbn:"978-4813704867", meta:{purpose:"story", category:"romance", tempo:"medium", world:"mixed", emotion:"high", difficulty:"easy"} },
      { id:78, title:"ã‚¢ãƒªã‚¹æ®ºã—", author:"å°æ—æ³°ä¸‰", isbn:"978-4488420147", meta:{purpose:"story", category:"mystery", tempo:"medium", world:"fantasy", emotion:"medium", difficulty:"normal"} },
      { id:79, title:"ä»£è¡¨å–ç· å½¹ã‚¢ã‚¤ãƒ‰ãƒ«", author:"å°æ—æ³°ä¸‰", isbn:"978-4163912134", meta:{purpose:"story", category:"drama", tempo:"medium", world:"real", emotion:"medium", difficulty:"normal"} },
      { id:80, title:"M æ„›ã™ã¹ãäººãŒã„ã¦", author:"å°æ¾æˆç¾", isbn:"978-4344429819", meta:{purpose:"growth", category:"nonfic", tempo:"medium", world:"real", emotion:"high", difficulty:"normal"} }
    ];

    // =========================
    // çŠ¶æ…‹ç®¡ç†
    // =========================
    let currentIndex = 0;
    let answers = [];
    let lastProfile = null;
    let lastBook = null;

    // DOM
    const screenStart = document.getElementById("screen-start");
    const screenQuestion = document.getElementById("screen-question");
    const screenResult = document.getElementById("screen-result");

    const startButton = document.getElementById("startButton");
    const nextButton = document.getElementById("nextButton");
    const restartButton = document.getElementById("restartButton");

    const questionCounter = document.getElementById("questionCounter");
    const questionText = document.getElementById("questionText");
    const choicesContainer = document.getElementById("choicesContainer");
    const progressInner = document.getElementById("progressInner");
    const progressLabel = document.getElementById("progressLabel");

    const resultType = document.getElementById("resultType");
    const resultDesc = document.getElementById("resultDesc");
    const recBookTitle = document.getElementById("recBookTitle");
    const recBookAuthor = document.getElementById("recBookAuthor");
    const recBookIsbn = document.getElementById("recBookIsbn");
    const recTags = document.getElementById("recTags");

    const bookCard = document.getElementById("bookCard");
    const bookThumb = document.getElementById("bookThumb");

    const shareXBtn = document.getElementById("shareXBtn");
    const shareInstaBtn = document.getElementById("shareInstaBtn");

    const detailOverlay = document.getElementById("detailOverlay");
    const detailTitle = document.getElementById("detailTitle");
    const detailMeta = document.getElementById("detailMeta");
    const detailIsbn = document.getElementById("detailIsbn");
    const detailAttrs = document.getElementById("detailAttrs");
    const detailSearchLink = document.getElementById("detailSearchLink");
    const detailCloseBtn = document.getElementById("detailCloseBtn");

    // =========================
    // ã‚¤ãƒ™ãƒ³ãƒˆ
    // =========================
    startButton.addEventListener("click", () => {
      screenStart.style.display = "none";
      screenQuestion.style.display = "block";
      currentIndex = 0;
      answers = [];
      lastProfile = null;
      lastBook = null;
      renderQuestion();
    });

    nextButton.addEventListener("click", () => {
      const selected = document.querySelector(".choice.selected");
      if (!selected) return;
      const value = Number(selected.dataset.value);
      answers[currentIndex] = value;

      if (currentIndex < questions.length - 1) {
        currentIndex++;
        renderQuestion();
      } else {
        showResult();
      }
    });

    restartButton.addEventListener("click", () => {
      screenResult.style.display = "none";
      screenStart.style.display = "block";
    });

    // æœ¬ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ â†’ è©³ç´°
    bookCard.addEventListener("click", () => {
      if (!lastBook || !lastProfile) return;
      openDetailOverlay(lastBook, lastProfile);
    });

    // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤é–‰ã˜ã‚‹
    detailCloseBtn.addEventListener("click", () => {
      detailOverlay.style.display = "none";
    });
    detailOverlay.addEventListener("click", (e) => {
      if (e.target === detailOverlay) {
        detailOverlay.style.display = "none";
      }
    });

    // Xã§ã‚·ã‚§ã‚¢
    shareXBtn.addEventListener("click", () => {
      if (!lastBook || !lastProfile) return;
      const text =
        `èª­æ›¸ã‚¿ã‚¤ãƒ—è¨ºæ–­ã§ã€Œ${lastProfile.typeName}ã€ã‚¿ã‚¤ãƒ—ã§ã—ãŸã€‚\n` +
        `ãŠã™ã™ã‚æœ¬ã¯ã€${lastBook.title}ã€ã€‚\n`;
      const url = location.href;
      const shareUrl =
        "https://twitter.com/intent/tweet?text=" +
        encodeURIComponent(text) +
        "&url=" +
        encodeURIComponent(url);
      window.open(shareUrl, "_blank", "noopener,noreferrer");
    });

    // Instagramãƒœã‚¿ãƒ³ï¼ˆãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒˆãƒƒãƒ— or ã‚¢ãƒ—ãƒªèµ·å‹•ç”¨ãƒªãƒ³ã‚¯ï¼‰
    shareInstaBtn.addEventListener("click", () => {
      // æŠ•ç¨¿ã«ç›´æ¥ãƒ†ã‚­ã‚¹ãƒˆã‚’æµã—è¾¼ã‚€ã“ã¨ã¯ã§ããªã„ã®ã§ã€
      // ã¨ã‚Šã‚ãˆãšInstagramãƒˆãƒƒãƒ—ã‚’é–‹ããƒ¢ãƒƒã‚¯ã€‚
      window.open("https://www.instagram.com/", "_blank", "noopener,noreferrer");
    });

    // =========================
    // è³ªå•æç”»
    // =========================
    function renderQuestion() {
      nextButton.disabled = true;

      questionCounter.textContent = `Q${currentIndex + 1}`;
      questionText.textContent = questions[currentIndex];

      const progress = (currentIndex / questions.length) * 100;
      progressInner.style.width = `${progress}%`;
      progressLabel.textContent = `è³ªå• ${currentIndex + 1} / ${questions.length}`;

      choicesContainer.innerHTML = "";

      choices.forEach((c) => {
        const div = document.createElement("div");
        div.className = "choice";
        div.dataset.value = c.value;

        div.innerHTML = `
          <div class="choice-main">
            <div class="choice-pill"></div>
            <span>${c.label}</span>
          </div>
          <div class="choice-hint">${c.hint}</div>
        `;

        div.addEventListener("click", () => {
          document.querySelectorAll(".choice").forEach(ch => ch.classList.remove("selected"));
          div.classList.add("selected");
          nextButton.disabled = false;
        });

        choicesContainer.appendChild(div);
      });

      // ã™ã§ã«å›ç­”ãŒã‚ã‚Œã°å¾©å…ƒ
      if (typeof answers[currentIndex] === "number") {
        const idx = choices.findIndex(c => c.value === answers[currentIndex]);
        if (idx >= 0 && choicesContainer.children[idx]) {
          choicesContainer.children[idx].classList.add("selected");
          nextButton.disabled = false;
        }
      }
    }

    // =========================
    // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨ˆç®—ï¼ˆå…ˆç”Ÿå‘ã‘ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
    // =========================
    function getTypeInfo(ans) {
      const total = ans.reduce((a, b) => a + b, 0);

      // ç›®çš„ã‚¹ã‚³ã‚¢
      const purpose = { relax:0, learning:0, story:0, growth:0 };
      // ã‚«ãƒ†ã‚´ãƒªã‚¹ã‚³ã‚¢
      const cat = { drama:0, mystery:0, romance:0, suspense:0, fantasy:0, human:0, business:0, selfhelp:0, essay:0, nonfic:0 };
      // å—œå¥½è»¸
      let fastSlow = 0;      // +ã§Fastã€-ã§Slow
      let realFantasy = 0;   // +ã§Fantasyã€-ã§Real
      let emotionAxis = 0;   // +ã§æ„Ÿæƒ…ã€-ã§æ€è€ƒ
      let depthAxis = 0;     // +ã§æ·±ã•

      // Q1 çŸ¥è­˜/æƒ…å ± vs ç‰©èª
      if (ans[0] != null) {
        purpose.learning += ans[0] > 0 ? 2 : 0;
        purpose.story    += ans[0] < 0 ? 2 : 0;
      }

      // Q2 æƒ…ç·’å…±æ„Ÿ â†’ ãƒ‰ãƒ©ãƒ/ãƒ’ãƒ¥ãƒ¼ãƒãƒ³
      if (ans[1] != null) {
        emotionAxis += ans[1];
        cat.drama   += ans[1] > 0 ? 2 : 0;
        cat.human   += ans[1] > 0 ? 1 : 0;
      }

      // Q3 ãƒ†ãƒ³ãƒé€Ÿã„
      if (ans[2] != null) {
        fastSlow += ans[2];
      }

      // Q4 é‡åšãªç‰©èª
      if (ans[3] != null) {
        depthAxis += ans[3];
        fastSlow  -= ans[3] * 0.5;
      }

      // Q5 ç¾å®Ÿå¯„ã‚Š
      if (ans[4] != null) {
        realFantasy -= ans[4];
        cat.drama   += ans[4] > 0 ? 1 : 0;
        cat.human   += ans[4] > 0 ? 1 : 0;
      }

      // Q6 éç¾å®Ÿå¯„ã‚Š
      if (ans[5] != null) {
        realFantasy += ans[5];
        cat.fantasy += ans[5] > 0 ? 2 : 0;
      }

      // Q7 æ°—ã¥ãé‡è¦– â†’ å­¦ã³/æˆé•·/è‡ªå·±å•“ç™º
      if (ans[6] != null) {
        purpose.learning += ans[6] > 0 ? 1 : 0;
        purpose.growth   += ans[6] > 0 ? 2 : 0;
        cat.selfhelp     += ans[6] > 0 ? 2 : 0;
        depthAxis        += ans[6] * 0.5;
      }

      // Q8 é•·æ™‚é–“æµ¸ã‚‹
      if (ans[7] != null) {
        depthAxis += ans[7];
        fastSlow  -= ans[7] * 0.5;
      }

      // Q9 å¿ƒç†æå†™
      if (ans[8] != null) {
        emotionAxis += ans[8] * 1.2;
        cat.drama   += ans[8] > 0 ? 2 : 0;
        cat.human   += ans[8] > 0 ? 1 : 0;
      }

      // Q10 ä¼ç·šãƒ»æ§‹é€ 
      if (ans[9] != null) {
        cat.mystery += ans[9] > 0 ? 3 : 0;
        depthAxis   += ans[9];
      }

      // Q11 æ„Ÿæƒ³å…±æœ‰ â†’ è©±é¡Œæ€§ã®ã‚ã‚‹ã‚¸ãƒ£ãƒ³ãƒ«
      if (ans[10] != null) {
        purpose.relax += ans[10] > 0 ? 1 : 0;
        cat.mystery   += ans[10] > 0 ? 1 : 0;
        cat.romance   += ans[10] > 0 ? 1 : 0;
        cat.human     += ans[10] > 0 ? 1 : 0;
      }

      // ç›®çš„ã®æ±ºå®š
      let purposeKey = "story";
      let maxP = -Infinity;
      Object.entries(purpose).forEach(([k,v])=>{
        if(v > maxP){ maxP = v; purposeKey = k; }
      });

      // ã‚«ãƒ†ã‚´ãƒªã®æ±ºå®š
      let catKey = "drama";
      let maxC = -Infinity;
      Object.entries(cat).forEach(([k,v])=>{
        if(v > maxC){ maxC = v; catKey = k; }
      });

      // ãƒ†ãƒ³ãƒå—œå¥½
      let tempoPref = "medium";
      if (fastSlow >= 3) tempoPref = "fast";
      else if (fastSlow <= -3) tempoPref = "slow";

      // ä¸–ç•Œè¦³å—œå¥½
      let worldPref = "mixed";
      if (realFantasy >= 3) worldPref = "fantasy";
      else if (realFantasy <= -3) worldPref = "real";

      // æ„Ÿæƒ…è»¸
      let emotionPref = "medium";
      if (emotionAxis >= 4) emotionPref = "high";
      else if (emotionAxis <= -2) emotionPref = "low";

      // æ·±ã•
      let depthPref = "medium";
      if (depthAxis >= 4) depthPref = "deep";
      else if (depthAxis <= -2) depthPref = "light";

      // ã‚¿ã‚¤ãƒ—åï¼ˆè‰² Ã— ä¸–ç•Œè¦³ï¼‰
      let colorWord = "";
      if (emotionAxis >= 4) {
        colorWord = "ãƒ”ãƒ³ã‚¯ãƒ–ãƒ­ãƒƒã‚µãƒ ";
      } else if (emotionAxis >= 1) {
        colorWord = "ãƒ©ãƒ™ãƒ³ãƒ€ãƒ¼";
      } else if (emotionAxis <= -3) {
        colorWord = "ãƒ¢ã‚«ãƒ–ãƒ©ã‚¦ãƒ³";
      } else {
        colorWord = "ãƒŸãƒ³ãƒˆã‚°ãƒªãƒ¼ãƒ³";
      }

      let worldWord = "";
      if (worldPref === "fantasy") {
        worldWord = "ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼ãƒ¯ãƒ¼ãƒ«ãƒ‰";
      } else if (worldPref === "real") {
        worldWord = "ãƒªã‚¢ãƒ«ãƒ©ã‚¤ãƒ•";
      } else {
        worldWord = "ãƒŸãƒƒã‚¯ã‚¹ãƒ¯ãƒ¼ãƒ«ãƒ‰";
      }

      const typeName = `${colorWord}ãƒ»${worldWord}ã‚¿ã‚¤ãƒ—`;

      // èª¬æ˜ãƒ†ã‚­ã‚¹ãƒˆ
      let desc = "";
      if (colorWord === "ãƒ”ãƒ³ã‚¯ãƒ–ãƒ­ãƒƒã‚µãƒ " && worldPref === "fantasy") {
        desc = "æ„Ÿæƒ…ç§»å…¥ã¨éæ—¥å¸¸ã®ä¸–ç•Œè¦³ã®ã©ã¡ã‚‰ã‚‚å¼·ãæ±‚ã‚ã‚‹ã‚¿ã‚¤ãƒ—ã€‚ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®å¿ƒæƒ…ã«å¯„ã‚Šæ·»ã„ãªãŒã‚‰ã€æ—¥å¸¸ã§ã¯å‘³ã‚ãˆãªã„å‡ºæ¥äº‹ã«å·»ãè¾¼ã¾ã‚Œã¦ã„ãç‰©èªã¨ã®ç›¸æ€§ãŒè‰¯ã„ã€‚åˆ‡ãªã•ã‚„ã¨ãã‚ãã®ã‚ã‚‹ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚„ã€ãƒ‰ãƒ©ãƒãƒãƒƒã‚¯ãªå±•é–‹ãŒç¶šãä½œå“ãŒã€Œåˆºã•ã‚‹ä¸€å†Šã€ã«ãªã‚Šã‚„ã™ã„ã€‚";
      } else if (colorWord === "ãƒ”ãƒ³ã‚¯ãƒ–ãƒ­ãƒƒã‚µãƒ ") {
        desc = "äººç‰©ã®æ„Ÿæƒ…ã‚„é–¢ä¿‚æ€§ã‚’ä½•ã‚ˆã‚Šå¤§äº‹ã«ã—ãŸã„ã‚¿ã‚¤ãƒ—ã€‚ä¸–ç•Œè¦³ãŒç¾å®Ÿå¯„ã‚Šã§ã‚‚éæ—¥å¸¸å¯„ã‚Šã§ã‚‚ã€ç™»å ´äººç‰©ã®å¿ƒã®æºã‚Œã‚„è·é›¢æ„ŸãŒä¸å¯§ã«æã‹ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ãŒã€ä½œå“ã®å¥½ãå«Œã„ã‚’åˆ†ã‘ã‚‹ã€‚æ‹æ„›ãƒ»é’æ˜¥ãƒ»ãƒ’ãƒ¥ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒç³»ã®ç‰©èªã«ã¯ã€ç‰¹ã«å¼·ãæƒ¹ãã¤ã‘ã‚‰ã‚Œã‚„ã™ã„ã€‚";
      } else if (colorWord === "ãƒ©ãƒ™ãƒ³ãƒ€ãƒ¼" && worldPref === "fantasy") {
        desc = "ä¸–ç•Œè¦³ã®åºƒãŒã‚Šã¨ã€ã—ã£ã¨ã‚Šã—ãŸæ„Ÿæƒ…ã®ä½™éŸ»ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å¥½ã‚€ã‚¿ã‚¤ãƒ—ã€‚æ¿€ã—ã™ãã‚‹å±•é–‹ã‚ˆã‚Šã‚‚ã€é™ã‹ã«å¿ƒã«æ®‹ã‚‹å°è©ã‚„ã‚·ãƒ¼ãƒ³ã‚’ã˜ã£ãã‚Šå‘³ã‚ã„ãŸã„ã»ã†ã€‚å°‘ã—ä¸æ€è­°ãªè¨­å®šã‚„ã€ç¾å®Ÿã¨éš£ã‚Šåˆã‚ã›ã®ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼ä½œå“ã‚’ã€ŒãŠæ°—ã«å…¥ã‚Šã€ã«ã—ã‚„ã™ã„ã€‚";
      } else if (colorWord === "ãƒŸãƒ³ãƒˆã‚°ãƒªãƒ¼ãƒ³" && worldPref === "real") {
        desc = "ã™ã“ã—å¼•ã„ãŸç›®ç·šã§ã€ç¾å®Ÿã«è¿‘ã„ãƒ†ãƒ¼ãƒã‚’å‘³ã‚ã†ã®ãŒå¾—æ„ãªã‚¿ã‚¤ãƒ—ã€‚äººé–“ã‚„ç¤¾ä¼šã‚’æãä½œå“ã®ä¸­ã‹ã‚‰ã€è‡ªåˆ†ãªã‚Šã®è§£é‡ˆã‚„æ°—ã¥ãã‚’æ‹¾ã„ä¸Šã’ã‚‹èª­ã¿æ–¹ãŒå‘ã„ã¦ã„ã‚‹ã€‚ä»•äº‹ãƒ»å®¶æ—ãƒ»å‹æƒ…ãªã©ã€èº«è¿‘ãªé¡Œæã‚’æ‰±ã†ç‰©èªã«ã€ã˜ã‚ã˜ã‚å…±æ„Ÿã™ã‚‹ã“ã¨ãŒå¤šã„ã€‚";
      } else if (colorWord === "ãƒ¢ã‚«ãƒ–ãƒ©ã‚¦ãƒ³") {
        desc = "æ´¾æ‰‹ãªæ¼”å‡ºã‚ˆã‚Šã‚‚ã€è½ã¡ç€ã„ãŸãƒˆãƒ¼ãƒ³ã¨é‡ã¿ã®ã‚ã‚‹ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å¥½ã‚€ã‚¿ã‚¤ãƒ—ã€‚èª­ã¿é€²ã‚ã‚‹ã®ã«å°‘ã—ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒå¿…è¦ã§ã‚‚ã€ãã®ã¶ã‚“èª­å¾Œã«æ·±ã„æº€è¶³æ„Ÿã‚’å¾—ã‚„ã™ã„ã€‚ãƒŸã‚¹ãƒ†ãƒªã‚„ç¤¾ä¼šæ´¾ã€å¿ƒç†æå†™ã®æ¿ƒã„ä½œå“ãªã©ã€ã€Œè…°ã‚’æ®ãˆã¦å‘ãåˆã†ä¸€å†Šã€ã¨ã®ç¸ãŒå¼·ã„ã€‚";
      } else {
        desc = "æ„Ÿæƒ…ãƒ»ä¸–ç•Œè¦³ãƒ»æ§‹æˆã®ã©ã‚Œã‹ä¸€ã¤ã«åã‚Šã™ããªã„ã€ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ©ãƒ«ãªèª­æ›¸æ°—è³ªã€‚è©±é¡Œä½œãƒ»æ˜ åƒåŒ–ä½œå“ãƒ»å®šç•ªå°èª¬ãªã©ã€ã¾ãšã¯ã„ã‚ã„ã‚è§¦ã‚Œã¦ã¿ã‚‹ã“ã¨ã§ã€Œè‡ªåˆ†ã®å¥½ããªå‚¾å‘ã€ãŒè‡ªç„¶ã¨è¦‹ãˆã¦ãã‚‹ã‚¿ã‚¤ãƒ—ã€‚è¨ºæ–­çµæœã‚’ãã£ã‹ã‘ã«ã€æ–°ã—ã„ã‚¸ãƒ£ãƒ³ãƒ«ã‚’è©¦ã—ã¦ã¿ã‚‹ã®ã‚‚ãŠã™ã™ã‚ã€‚";
      }

      const tags = [];
      if (emotionAxis >= 2) tags.push("#æ„Ÿæƒ…ç§»å…¥é‡è¦–");
      if (emotionAxis <= -2) tags.push("#æ€è€ƒæ´¾èª­è€…");
      if (worldPref === "fantasy") tags.push("#éæ—¥å¸¸ãŒå¥½ã");
      if (worldPref === "real") tags.push("#ç¾å®Ÿå¯„ã‚Šã‚¹ãƒˆãƒ¼ãƒªãƒ¼");
      if (fastSlow >= 2) tags.push("#ãƒ†ãƒ³ãƒé‡è¦–");
      if (fastSlow <= -2) tags.push("#ã˜ã£ãã‚Šæ´¾");
      if (depthPref === "deep") tags.push("#èª­å¾Œã®ä½™éŸ»é‡è¦–");
      if (tags.length === 0) tags.push("#ãƒãƒ©ãƒ³ã‚¹å‹èª­æ›¸ã‚¿ã‚¤ãƒ—");

      return {
        typeName,
        desc,
        tags,
        totalScore: total,
        purpose: purposeKey,
        category: catKey,
        tempoPref,
        worldPref,
        emotionPref,
        depthPref
      };
    }

    // =========================
    // æœ¬ã¨ã®ãƒãƒƒãƒãƒ³ã‚°ã‚¹ã‚³ã‚¢
    // =========================
    function scoreBook(book, profile) {
      const m = book.meta || {};
      let s = 0;

      // ç›®çš„ä¸€è‡´
      if (m.purpose === profile.purpose) s += 4;
      // ã‚«ãƒ†ã‚´ãƒªä¸€è‡´
      if (m.category === profile.category) s += 4;

      // ä¸–ç•Œè¦³
      if (profile.worldPref === m.world) s += 3;
      else if (profile.worldPref === "mixed" || m.world === "mixed") s += 1;

      // ãƒ†ãƒ³ãƒ
      if (profile.tempoPref === m.tempo) s += 2;

      // æ„Ÿæƒ…é‡
      if (profile.emotionPref === m.emotion) s += 2;

      // æ·±ã•
      if (profile.depthPref === "deep" && (m.difficulty === "normal" || m.difficulty === "hard")) s += 1;
      if (profile.depthPref === "light" && m.difficulty === "easy") s += 1;

      return s;
    }

    // =========================
    // çµæœè¡¨ç¤º
    // =========================
    function showResult() {
      screenQuestion.style.display = "none";
      screenResult.style.display = "block";
      progressInner.style.width = "100%";

      const info = getTypeInfo(answers);
      lastProfile = info;

      resultType.textContent = info.typeName;
      resultDesc.textContent = info.desc;

      // æœ¬ã®ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰
      let bestBook = null;
      let bestScore = -Infinity;

      books.forEach(b => {
        const s = scoreBook(b, info);
        if (s > bestScore) {
          bestScore = s;
          bestBook = b;
        }
      });

      if (!bestBook || bestScore <= 0) {
        bestBook = books[Math.floor(Math.random() * books.length)];
      }
      lastBook = bestBook;

      recBookTitle.textContent = `ãŠã™ã™ã‚ã®ä¸€å†Šï¼š${bestBook.title}`;
      recBookAuthor.textContent = `è‘—è€…ï¼š${bestBook.author}`;
      recBookIsbn.textContent = `ISBNï¼š${bestBook.isbn}`;

      recTags.innerHTML = "";
      info.tags.forEach(t => {
        const span = document.createElement("span");
        span.className = "tag-pill";
        span.textContent = t;
        recTags.appendChild(span);
      });

      bookThumb.textContent = "æœ¬";
    }

    // =========================
    // è©³ç´°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤
    // =========================
    function openDetailOverlay(book, profile) {
      detailTitle.textContent = book.title;
      detailMeta.textContent = `è‘—è€…ï¼š${book.author}`;
      detailIsbn.textContent = `ISBNï¼š${book.isbn}`;
      detailAttrs.innerHTML = "";

      const m = book.meta || {};

      const attrMap = [
        { label:"ç›®çš„", key:"purpose", map:{
          relax:"æ°—åˆ†è»¢æ›ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¡å¯„ã‚Š",
          learning:"çŸ¥è­˜ãƒ»ãƒ“ã‚¸ãƒã‚¹ãƒ»å®Ÿç”¨å¯„ã‚Š",
          story:"ç‰©èªã‚’æ¥½ã—ã‚€ãƒ¡ã‚¤ãƒ³",
          growth:"è‡ªå·±æˆé•·ãƒ»ãƒãƒ³ãƒ•ã‚£ã‚¯ã‚·ãƒ§ãƒ³å¯„ã‚Š"
        }},
        { label:"ã‚«ãƒ†ã‚´ãƒª", key:"category", map:{
          drama:"ãƒ‰ãƒ©ãƒãƒ»æ–‡å­¦å¯„ã‚Š",
          mystery:"ãƒŸã‚¹ãƒ†ãƒªãƒ¼ / ãƒˆãƒªãƒƒã‚¯",
          romance:"æ‹æ„›ãƒ»ãƒ©ãƒ–ã‚¹ãƒˆãƒ¼ãƒªãƒ¼",
          suspense:"ã‚µã‚¹ãƒšãƒ³ã‚¹ãƒ»ã©ãã©ãç³»",
          fantasy:"ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼ / éæ—¥å¸¸",
          human:"é’æ˜¥ãƒ»ãƒ’ãƒ¥ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ",
          business:"ãƒ“ã‚¸ãƒã‚¹ãƒ»ä»•äº‹",
          selfhelp:"è‡ªå·±å•“ç™ºãƒ»ãƒ©ã‚¤ãƒ•ãƒãƒƒã‚¯",
          essay:"ã‚¨ãƒƒã‚»ã‚¤ / ãƒãƒ³ãƒ•ã‚£ã‚¯ã‚·ãƒ§ãƒ³å¯„ã‚Š",
          nonfic:"ãƒãƒ³ãƒ•ã‚£ã‚¯ã‚·ãƒ§ãƒ³"
        }},
        { label:"ãƒ†ãƒ³ãƒ", key:"tempo", map:{
          fast:"ãƒ†ãƒ³ãƒé€Ÿã‚ï¼ˆã‚µã‚¯ã‚µã‚¯èª­ã‚ã‚‹ï¼‰",
          medium:"ãµã¤ã†ã®ãƒ†ãƒ³ãƒ",
          slow:"ã˜ã£ãã‚Šèª­ã¿é€²ã‚ã‚‹ç³»"
        }},
        { label:"ä¸–ç•Œè¦³", key:"world", map:{
          real:"ç¾å®Ÿå¯„ã‚Šã®ä¸–ç•Œè¦³",
          fantasy:"éæ—¥å¸¸ãƒ»ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼å¯„ã‚Š",
          mixed:"ç¾å®Ÿï¼‹å°‘ã—ä¸æ€è­°"
        }},
        { label:"æ„Ÿæƒ…ã®æ¿ƒã•", key:"emotion", map:{
          high:"æ„Ÿæƒ…æå†™ãŒæ¿ƒã„",
          medium:"ã»ã©ã‚ˆãæ„Ÿæƒ…ã‚‚ã‚ã‚‹",
          low:"ã©ã¡ã‚‰ã‹ã¨ã„ãˆã°æ€è€ƒå¯„ã‚Š"
        }},
        { label:"èª­ã¿ã”ãŸãˆ", key:"difficulty", map:{
          easy:"èª­ã¿ã‚„ã™ã„ / ãƒ©ã‚¤ãƒˆ",
          normal:"ãµã¤ã†",
          hard:"ã‚„ã‚„ã˜ã£ãã‚Šç³»"
        }}
      ];

      attrMap.forEach(cfg => {
        const val = m[cfg.key];
        if (!val) return;
        const span = document.createElement("span");
        span.className = "overlay-attr-pill";
        const label = cfg.map[val] || val;
        span.textContent = `${cfg.label}ï¼š${label}`;
        detailAttrs.appendChild(span);
      });

      const q = encodeURIComponent(`${book.title} ${book.isbn}`);
      detailSearchLink.href = `https://www.google.com/search?q=${q}`;

      detailOverlay.style.display = "flex";
    }
  </script>
</body>
</html>